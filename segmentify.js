/* Last Update: Tue, 02 Jun 2020 04:04:19 GMT */
/* cetinkaya */
/* Do not load Segmentify more than one to prevent potential error occurrence */
if (window['SegmentifyTrackingObject']) {
  throw new Error("Segmentify is already loaded!");
}

var segNamespace = "Segmentify";

window['SegmentifyTrackingObject'] = segNamespace;

window[segNamespace] = window[segNamespace] || function () {
  (window[segNamespace].q = window[segNamespace].q || []).push(arguments);
};

window[segNamespace].config = {
  segmentifyApiUrl: '//gandalf.segmentify.com/',
  domain: '.cetinkaya.com.tr',
  jq: window.jQuery,
  disableNextPage: true,
  categoryHierarchy: true,
  language: "TR"
};

Segmentify('apikey', '9201f567-a971-41cf-9ea3-99a458210482');

function waitSegmentifyAndjQuery() {
  if (window["_SgmntfY_"] && window["_SgmntfY_"]._getJq()) {
    window.segJquery = window["_SgmntfY_"]._getJq();

    segJquery(document).ready(function () {
      SegmentifyIntegration(window.segJquery).init();
    });
  } else {
    setTimeout(waitSegmentifyAndjQuery, 100);
  }
}

var SegmentifyIntegration = function (jQuery) {
  var segmentifyEvents = {
    viewPage: function (category, subCategory, params) {
      /* console.log("Pageview Event is going", category, subCategory, params); */
      Segmentify('view:page', {
        'category': category,
        'subCategory': subCategory,
        'params': params
      });
    },
    viewProduct: function (productObj) {
      /* console.log("Product View Event is going", productObj); */
      Segmentify('view:product', productObj);
    },
    checkoutBasket: function (basketObj) {
      /* console.log("Checkout Basket event is going", basketObj); */
      Segmentify('checkout:basket', basketObj);
    },
    checkoutPurchase: function (purchaseObj) {
      /* console.log("Checkout Purchase event is going", purchaseObj); */
      Segmentify('checkout:purchase', purchaseObj);
    },
    basketAdd: function (basketObj) {
      /* console.log("Basket Add Event is going", basketObj); */
      Segmentify('basket:add', basketObj);
    },
    basketRemove: function (basketObj) {
      /* console.log("Basket Remove Event is going", basketObj); */
      Segmentify('basket:remove', basketObj);
    },
    basketClear: function (basketObj) {
      /* console.log("Basket Clear Event is going", basketObj); */
      Segmentify('basket:clear', basketObj);
    },
    userUpdate: function (userObj) {
      /* console.log("User Update Event is going", userObj); */
      Segmentify('user:update', userObj);
    },
    userSignup: function (signupObj) {
      /* console.log("User Sign-up Event is going", signupObj); */
      Segmentify('user:signup', signupObj);
    },
    userId: function (id) {
      /* console.log("User ID is going to be changed", id); */
      Segmentify('userid', id);
    },
    custom: function (customObj) {
      /* console.log("Custom Event is going", customObj); */
      Segmentify('event:custom', customObj);
    }
  };

  var helperFunctions = {
    "setCookie": function (cname, cvalue, exdays) {
      window["_SgmntfY_"]._storePersistentData(cname, cvalue, exdays, false);
    },
    "getCookie": function (cname) {
      return window["_SgmntfY_"]._getPersistentData(cname, false);
    },
    "getQueryParameter": function (pname, url) {
      return window["_SgmntfY_"]._getQueryParameter(pname, url);
    },
    "priceFormatter": function (price, separators, currency_symbol) {
      try {
        var temp = (price || "").toString();

        if (temp) {
          // remove all unwanted characters if it is not a number
          var allowedChars = "0123456789.,";

          for (var i = 0; i < price.length; i++) {
            if (allowedChars.indexOf(price[i]) < 0) {
              temp = temp.replace(price[i], "");
            }
          }

          // remove redundant decimal separators
          var occurences = temp.match(/\./g);

          if (occurences && Array.isArray(occurences) && occurences.length > 1) {
            for (var i = 0; i < occurences.length - 1; i++) {
              temp = temp.replace(".", "");
            }
          }

          // if separators provided, replace them
          if (separators && Array.isArray(separators) && separators.length === 2) {
            var regexPattern = "";
            var regex = null;

            if (separators[1]) {
              regexPattern = "\\" + separators[1];
              regex = new RegExp(regexPattern, "g");

              temp = temp.replace(regex, "");
            }

            if (separators[0]) {
              regexPattern = "\\" + separators[0];
              regex = new RegExp(regexPattern, "g");

              temp = temp.replace(regex, separators[1]);
            }
          }

          // if currency symbol is valid and has a string value, replace it
          if (currency_symbol && typeof currency_symbol === "string") {
            temp = temp.replace(currency_symbol, "");
          }

          // cast the price to float
          temp = parseFloat(temp.toString().trim().replace(/\s/g, "")).toFixed(2);

          return temp;
        }
        // if given parameters are not valid, return zero
        return 0;
      } catch (err) {
        // if any error occurs, return zero
        return 0;
      }
    },
    "findPropertyInArray": function (prop, arr) {
      try {
        // if property is not defined or empty string or array is empty exit function
        if (typeof prop !== "string" ||
          !prop ||
          !Array.isArray(arr)) {
          return null;
        }

        for (var i = 0; i < arr.length; i++) {
          var arr_item = arr[i];

          // if this array object contains property -prop-, so this is what we are looking for
          if (arr_item.hasOwnProperty(prop)) {
            return arr_item;
          }
        }
      } catch (err) {
        // prevent unexpected return type so return null
        return null;
      }
    }
  };


  var pageVariables = {
    category: "",
    subCategory: "",
    params: {}
  };

  var findPageType = function () {
    try {
      /* Home Page, Category Page, Product Page, Basket Page, Search Page, Checkout Success Page */

      if (document.location.pathname.indexOf("/brand/") >= 0) {
        pageVariables.category = "Brand Page";
        pageVariables.params.brand = jQuery(".font-weight-bold.text-dark.m-0").text().trim();
        return;
      }

      if (jQuery(".home-page-container").length) {
        pageVariables.category = "Home Page";
        return;
      }

      if (jQuery(".product-list-inner-container.bg-white").length) {
        pageVariables.category = "Category Page";
        var breadcrumbs = jQuery(".breadcrumb-item:not(:first):not(:first)");
        var bc = [];
        breadcrumbs.each(function (index) {
          var $this = jQuery(this).find("a").text().trim() || "";
          bc.push($this);
        });
        pageVariables.subCategory =  bc.join(" > ");
        return;
      }

      if (jQuery("#product-details-form").length) {
        pageVariables.category = "Product Page";
        return;
      }

      if (jQuery("form[action='/cart']").length && jQuery(".cart-page-actions").length && document.location.href.indexOf("/cart") > 0 ) {
        pageVariables.category = "Basket Page";
        return;
      }

      if (document.location.pathname.indexOf("/search") >= 0) {
        pageVariables.category = "Search Page";
        pageVariables.params["squery"] = _SgmntfY_._getQueryParameter("q");
        return;
      }

      if (jQuery("h3.font-weight-bold").text() == "BEKLENMEDİK BİR HATA OLUŞTU") {
        pageVariables.category = "404 Page";
        return;
      }

      if (jQuery("span[data-key-name='Checkout.YourOrderHasBeenSuccessfullyProcessed']").length && jQuery(".summary-wrapper.checkout").length) {
        pageVariables.category = "Checkout Success Page";
        return;
      }

      if (document.location.pathname.indexOf("pages/bayram") >= 0) {
        pageVariables.category = "Bayram Page";
        return;
      }

      if(google_tag_params.ecomm_pagetype === "other"){
        pageVariables.category = "Information Pages";
        return;
      }

      pageVariables.category = "Unknown Page";
    } catch (err) {
      window.segErr = err;
    }
  };

  var triggerPageFunction = function (category) {
    try {
      if (category && pageFunctions.hasOwnProperty(category)) {
        pageFunctions[category]();
      }

      pageFunctions["All Pages"]();
    } catch (err) {
      window.segErr = err;
    }
  };

  var init = function () {
    findPageType();
    triggerPageFunction(pageVariables.category);
  };

  var pageFunctions = {
    "All Pages": function () {
      segmentifyEvents.viewPage(pageVariables.category, pageVariables.subCategory, pageVariables.params);
    },
    "Brand Page": function () {
      segmentifyEvents.custom({
        "type": "brand-page-reco",
        "params": {
          "brand": jQuery(".font-weight-bold.text-dark.m-0").text().trim()
        }
      });
    },
    "Home Page": function () { },
    "Category Page": function () { },
    "Product Page": function () {
      var productObj = {};

      // Gather information about the product
     // productObj["brand"] = "";
      // productObj["title"] = jQuery("h4.product-detail-name").text().trim();
      productObj["title"] = jQuery(".product-detail-name").text().trim();
      productObj["productId"] = google_tag_params.ecomm_prodid || jQuery("meta[property='og:url']").attr("content").split("-")[jQuery("meta[property='og:url']").attr("content").split("-").length - 1];
      productObj["image"] = jQuery(".item.detail-md img").attr("src");
      productObj["price"] = helperFunctions.priceFormatter(jQuery(".product-price span").text(), [",", "."]);
      productObj["oldPrice"] = helperFunctions.priceFormatter(jQuery(".detail-price.detail-old-price").text(), [",", "."]);
      productObj["inStock"] = jQuery("#AddToCartContainer").attr("style") != "display:none;";
      productObj["url"] = jQuery("link[rel='canonical']").attr("href");
      productObj["category"] = jQuery(".breadcrumb-item:not(:last):last").text().trim();
      productObj["categories"] = [];
      productObj["params"] = {};

      productObj["categories"].push(jQuery(".breadcrumb-item:not(:last):last").text().trim());

      if (jQuery(".product-detail-images-container .badge-percent.font-italic.d-inline-block").length > 0) {
        productObj["params"]["discountRatio"] = jQuery(".product-detail-images-container .badge-percent.font-italic.d-inline-block").text()
      }

      if (jQuery(".product-price s").length > 0) {
        productObj["oldPrice"] = helperFunctions.priceFormatter(jQuery(".product-price s").text(), [",", "."]);
      }
      if(jQuery(".product-detail-images-container .badge-percent.font-italic.text-white.badge-bg.align-middle.rounded-circle.p-1.d-inline-block").text() !== ""){
        productObj["params"]["badge"] = "true";
      }
      
      productObj["noUpdate"] = ["title", "productId", "price", "oldPrice", "inStock", "url", "category", "categories"];

      if (parseFloat(productObj["price"]) > parseFloat(productObj["oldPrice"]) || parseFloat(productObj["oldPrice"]) === 0 || (parseFloat(productObj["oldPrice"]) === parseFloat(productObj["price"]))) {
        delete productObj["oldPrice"];
      }
      
      // Send product view event
      segmentifyEvents.viewProduct(productObj);
      window.jQuery(document).ajaxComplete(function (event, xhr, settings) {
        if (settings.url && settings.url.indexOf("/addproducttocart/details") >= 0 && xhr.status === 200 && xhr.responseText.indexOf('success":true') > 0) {

          segmentifyEvents.basketAdd({
            "productId": productObj["productId"] || "",
            "quantity": jQuery(".qty-input.valid").val() || "1",
            "price": productObj["price"] || "",
            "nextPage": false
          });
        }
      });
    },
    "Search Page": function () { },
    "404 Page": function () { },
    "Basket Page": function () {
      var basketAmount = helperFunctions.priceFormatter(jQuery(".order-small-price:last").text(), [",", "."]);
      var basketProducts = [];
      var basketRows = jQuery("tbody tr.d-block.d-md-table-row.border-bottom.pb-2.pt-2.p-md-0");

      basketRows.each(function (index) {
        var quantity = jQuery(this).find(".qty-input.cart-item-quantity").val() || 1;
        var price = helperFunctions.priceFormatter(jQuery(this).find(".cart-unit-price .d-inline-block.align-middle:last").text(), [",", "."]);
        var productId = jQuery(this).find(".cart-image-link.d-block:first").attr("href").split("-")
        [jQuery(this).find(".cart-image-link.d-block:first").attr("href").split("-").length - 1] || "";

        basketProducts.push({
          productId: productId,
          price: price,
          quantity: quantity
        });

        // handle quantity increase or decrease events
        jQuery(this).find(".input-group-btn:last").click(function () {
          var index = basketRows.find(".input-group-btn:last").index(this);
          var product = basketProducts[index];

          if (product) {
            // increase
            segmentifyEvents.basketAdd({
              'productId': product.productId,
              'price': product.price,
              'quantity': 1,
              'nextPage': false
            });
          }
        });

        jQuery(this).find(".input-group-btn:first").click(function () {
          var index = basketRows.find(".input-group-btn:first").index(this);
          var product = basketProducts[index];

          if (product) {
            // decrease
            segmentifyEvents.basketRemove({
              'productId': product.productId,
              'price': product.price,
              'quantity': 1,
              'nextPage': false
            });
          }
        });

        // handle remove from cart event
        jQuery(this).find(".cart-delete.align-middle.hide-payment-summary").click(function () {
          try {
            var index = basketRows.find(".cart-delete.align-middle.hide-payment-summary").index(this);
            var product = basketProducts[index];

            if (product) {
              segmentifyEvents.basketRemove(product);
            }
          } catch (e) {
            window.segErr = e;
          }
        });
      });

      // 100TL – 149,99TL arasında  “Sepette 15TL İndirim!”
      var discount15 = 100;
      // 150TL - 299,99TL arasında  “Sepette 25TL İndirim!”
      var discount25 = 150;
      // 300TL – 449,99TL arasında  “Sepette 50TL İndirim!”
      var discount50 = 300;
      // 450TL – 599,99TL arasında   “Sepette 75TL İndirim!”
      var discount75 = 450;
      // 600TL – 749,99TL arasında   “Sepette 100TL İndirim!”
      var discount100 = 600;
      // 750TL ve üzeri ürünlerde ürün detayda,   “Sepette 125TL İndirim!”
      var discount125 = 750;

      try {
        var totalPrice = helperFunctions.priceFormatter(jQuery(".order-small-price:last").text(), [",", "."]) || "0";
        var minPrice = '';

        if (parseFloat(totalPrice) < discount15) {
            minPrice = (discount15 - parseFloat(totalPrice));
        }
        if (parseFloat(totalPrice) > discount15 && parseFloat(totalPrice) < discount25) {
            minPrice = (discount25 - parseFloat(totalPrice));
        }
        if (parseFloat(totalPrice) > discount25 && parseFloat(totalPrice) < discount50) {
          minPrice = (discount50 - parseFloat(totalPrice));
        }
        if (parseFloat(totalPrice) > discount50 && parseFloat(totalPrice) < discount75) {
          minPrice = (discount75 - parseFloat(totalPrice));
        }
        if (parseFloat(totalPrice) > discount75 && parseFloat(totalPrice) < discount100) {
          minPrice = (discount100 - parseFloat(totalPrice));
        }
        if (parseFloat(totalPrice) > discount100 && parseFloat(totalPrice) < discount125) {
          minPrice = (discount125 - parseFloat(totalPrice));
        }
        var maxPrice = minPrice + 150;
      }catch(err) {}

        
      // Put basket event information into a variable
      var basketInfo = {
        "totalPrice": basketAmount,
        "productList": basketProducts,
        'params': {
          'minPrice': minPrice,
          'maxPrice': maxPrice
        }
      };

      // Send checkout basket event
      segmentifyEvents.checkoutBasket(basketInfo);
      helperFunctions.setCookie("_sgf_basketInfo", JSON.stringify(basketInfo), 1);
    },
    "Checkout Success Page": function () {
      var cartCookie = helperFunctions.getCookie("_sgf_basketInfo");

        if (cartCookie) {
          var cartObj = JSON.parse(cartCookie);

          if (cartObj) {
            var purchaseAmount = cartObj.totalPrice || "";
            var purchaseProducts = cartObj.productList || [];
            var orderNo = jQuery(".bg-white.p-5.text-center p strong").text();

            // Put purchase event information into a variable
            var purchaseInfo = {
              orderNo: orderNo,
              totalPrice: purchaseAmount,
              productList: purchaseProducts
            };

            // Send checkout purchase event
            segmentifyEvents.checkoutPurchase(purchaseInfo);

            // remove cart cookie
            helperFunctions.setCookie("_sgf_basketInfo", "", -1)
          }
        }
    }
  };

  return {
    init: init,
    events: segmentifyEvents,
    helpers: helperFunctions
  };
};

// Call Wait Function at the bottom of tne script
waitSegmentifyAndjQuery();
/* Tue Jun  2 04:01:18 UTC 2020 */
function initializeMustache(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function a(e){return"function"==typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var o=/\S/;function _(e){return!function(e,t){return s.call(e,t)}(o,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var m=/\s*/,g=/\s+/,d=/\s*=/,l=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function u(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function S(){this.cache={}}u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var r,s,o=this,_=!1;o;){if(e.indexOf(".")>0)for(t=o.view,r=e.split("."),s=0;null!=t&&s<r.length;)s===r.length-1&&(_=i(t,r[s])),t=t[r[s++]];else t=o.view[e],_=i(o.view,e);if(_)break;o=o.parent}n[e]=t}return a(t)&&(t=t.call(this.view)),t},S.prototype.clearCache=function(){this.cache={}},S.prototype.parse=function(t,a){var i=this.cache,s=i[t];return null==s&&(s=i[t]=function(t,a){if(!t)return[];var i,s,o,c=[],p=[],S=[],h=!1,v=!1;function Y(){if(h&&!v)for(;S.length;)delete p[S.pop()];else S=[];h=!1,v=!1}function y(e){if("string"==typeof e&&(e=e.split(g,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(r(e[0])+"\\s*"),s=new RegExp("\\s*"+r(e[1])),o=new RegExp("\\s*"+r("}"+e[1]))}y(a||e.tags);for(var b,E,I,w,C,O,R=new u(t);!R.eos();){if(b=R.pos,I=R.scanUntil(i))for(var A=0,T=I.length;A<T;++A)_(w=I.charAt(A))?S.push(p.length):v=!0,p.push(["text",w,b,b+1]),b+=1,"\n"===w&&Y();if(!R.scan(i))break;if(h=!0,E=R.scan(f)||"name",R.scan(m),"="===E?(I=R.scanUntil(d),R.scan(d),R.scanUntil(s)):"{"===E?(I=R.scanUntil(o),R.scan(l),R.scanUntil(s),E="&"):I=R.scanUntil(s),!R.scan(s))throw new Error("Unclosed tag at "+R.pos);if(C=[E,I,b,R.pos],p.push(C),"#"===E||"^"===E)c.push(C);else if("/"===E){if(!(O=c.pop()))throw new Error('Unopened section "'+I+'" at '+b);if(O[1]!==I)throw new Error('Unclosed section "'+O[1]+'" at '+b)}else"name"===E||"{"===E||"&"===E?v=!0:"="===E&&y(I)}if(O=c.pop())throw new Error('Unclosed section "'+O[1]+'" at '+R.pos);return function(e){for(var t,n=[],a=n,r=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":a.push(t),r.push(t),a=t[4]=[];break;case"/":r.pop()[5]=t[2],a=r.length>0?r[r.length-1][4]:n;break;default:a.push(t)}return n}(function(e){for(var t,n,a=[],r=0,i=e.length;r<i;++r)(t=e[r])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(a.push(t),n=t));return a}(p))}(t,a)),s},S.prototype.render=function(e,t,n){var a=this.parse(e),r=t instanceof p?t:new p(t);return this.renderTokens(a,r,n,e)},S.prototype.renderTokens=function(e,t,n,a){for(var r,i,s,o="",_=0,c=e.length;_<c;++_)s=void 0,"#"===(i=(r=e[_])[0])?s=this.renderSection(r,t,n,a):"^"===i?s=this.renderInverted(r,t,n,a):">"===i?s=this.renderPartial(r,t,n,a):"&"===i?s=this.unescapedValue(r,t):"name"===i?s=this.escapedValue(r,t):"text"===i&&(s=this.rawValue(r)),void 0!==s&&(o+=s);return o},S.prototype.renderSection=function(e,t,r,i){var s=this,o="",_=t.lookup(e[1]);if(_){if(n(_))for(var c=0,m=_.length;c<m;++c)o+=this.renderTokens(e[4],t.push(_[c]),r,i);else if("object"==typeof _||"string"==typeof _||"number"==typeof _)o+=this.renderTokens(e[4],t.push(_),r,i);else if(a(_)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(_=_.call(t.view,i.slice(e[3],e[5]),function(e){return s.render(e,t,r)}))&&(o+=_)}else o+=this.renderTokens(e[4],t,r,i);return o}},S.prototype.renderInverted=function(e,t,a,r){var i=t.lookup(e[1]);if(!i||n(i)&&0===i.length)return this.renderTokens(e[4],t,a,r)},S.prototype.renderPartial=function(e,t,n){if(n){var r=a(n)?n(e[1]):n[e[1]];return null!=r?this.renderTokens(this.parse(r),t,n,r):void 0}},S.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},S.prototype.escapedValue=function(t,n){var a=n.lookup(t[1]);if(null!=a)return e.escape(a)},S.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.2.1",e.tags=["{{","}}"];var h=new S;e.clearCache=function(){return h.clearCache()},e.parse=function(e,t){return h.parse(e,t)},e.render=function(e,t,a){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(r=e)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return h.render(e,t,a)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(!a(i))return s;i(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return c[e]})},e.Scanner=u,e.Context=p,e.Writer=S}!function(e,t,n){e.bowser=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function a(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var r,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),_=/nexus\s*[0-6]\s*/i.test(t),c=!_&&/nexus\s*[0-9]+/i.test(t),m=/CrOS/.test(t),g=/silk/i.test(t),d=/sailfish/i.test(t),l=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),u=/windows phone/i.test(t),p=(/SamsungBrowser/i.test(t),!u&&/windows/i.test(t)),S=!i&&!g&&/macintosh/i.test(t),h=!o&&!d&&!l&&!f&&/linux/i.test(t),v=a(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),Y=n(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t)&&!/tablet pc/i.test(t),b=!y&&/[^-]mobi/i.test(t),E=/xbox/i.test(t);/opera/i.test(t)?r={name:"Opera",opera:e,version:Y||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?r={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||Y}:/SamsungBrowser/i.test(t)?r={name:"Samsung Internet for Android",samsungBrowser:e,version:Y||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?r={name:"Opera Coast",coast:e,version:Y||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?r={name:"Yandex Browser",yandexbrowser:e,version:Y||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?r={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?r={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?r={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?r={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?r={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?r={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:u?(r={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},v?(r.msedge=e,r.version=v):(r.msie=e,r.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:m?r={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?r={name:"Microsoft Edge",msedge:e,version:v}:/vivaldi/i.test(t)?r={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||Y}:d?r={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(r={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=e,r.osname="Firefox OS")):g?r={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?r={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:Y||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(r={name:"WebOS",osname:"WebOS",webos:e,version:Y||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=e)):/bada/i.test(t)?r={name:"Bada",osname:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:l?r={name:"Tizen",osname:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||Y}:/qupzilla/i.test(t)?r={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||Y}:/chromium/i.test(t)?r={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||Y}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?r={name:"Android",version:Y}:/safari|applewebkit/i.test(t)?(r={name:"Safari",safari:e},Y&&(r.version=Y)):i?(r={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},Y&&(r.version=Y)):r=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||Y}:{name:n(/^(.*)\/(.*) /),version:a(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(r.name=r.name||"Blink",r.blink=e):(r.name=r.name||"Webkit",r.webkit=e),!r.version&&Y&&(r.version=Y)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=e,r.version=r.version||n(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||!o&&!r.silk?!r.windowsphone&&i?(r[i]=e,r.ios=e,r.osname="iOS"):S?(r.mac=e,r.osname="macOS"):E?(r.xbox=e,r.osname="Xbox"):p?(r.windows=e,r.osname="Windows"):h&&(r.linux=e,r.osname="Linux"):(r.android=e,r.osname="Android");var I="";r.windows?I=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?I=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?I=(I=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):i?I=(I=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):o?I=n(/android[ \/-](\d+(\.\d+)*)/i):r.webos?I=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?I=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?I=n(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(I=n(/tizen[\/\s](\d+(\.\d+)*)/i)),I&&(r.osversion=I);var w=!r.windows&&I.split(".")[0];return y||c||"ipad"==i||o&&(3==w||w>=4&&!b)||r.silk?r.tablet=e:(b||"iphone"==i||"ipod"==i||o||_||r.blackberry||r.webos||r.bada)&&(r.mobile=e),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=e:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=e:r.x=e,r}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function a(e){return e.split(".").length}function r(e,t){var n,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)a.push(t(e[n]));return a}function i(e){for(var t=Math.max(a(e[0]),a(e[1])),n=r(e,function(e){var n=t-a(e);return r((e+=new Array(n+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function s(e,a,r){var s=n;"string"==typeof a&&(r=a,a=void 0),void 0===a&&(a=!1),r&&(s=t(r));var o=""+s.version;for(var _ in e)if(e.hasOwnProperty(_)&&s[_]){if("string"!=typeof e[_])throw new Error("Browser version in the minVersion map should be a string: "+_+": "+String(e));return i([o,e[_]])<0}return a}return n.test=function(e){for(var t=0;t<e.length;++t){var a=e[t];if("string"==typeof a&&a in n)return!0}return!1},n.isUnsupportedBrowser=s,n.compareVersions=i,n.check=function(e,t,n){return!s(e,t,n)},n._detect=t,n}()}(this),function(){var _SgmntfY_=window._SgmntfY_={LOG_LEVELS:{SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},_variables:{jq:window.SegmentifyjQuery||null,mustache:null,domain:window.SegmentifyDomain||window.location.hostname,ua:{agentString:window.navigator.userAgent,type:null,name:null,version:null,os:null,osversion:null},search:{maxMobileWidth:801,searchMinChar:0,searchDelay:0,input:"",cancelText:"Cancel",showAll:"Show All",notFound:"Sorry, there are no results for that search term. "},userStorageKey:"_sgf_user_id",sessionStorageKey:"_sgf_session_id",pushPermissionKey:"_sgf_push_permission_asked",testMode:"_sgf_test_mode",tracking:"_sgf_tracking",storage:{delayedActions:{key:"_sgf_delayed_actions",local:!0},delayedCampaigns:{key:"_sgf_delayed_campaigns",local:!0},retryQueue:{key:"_sgf_rq",local:!0},extensionStatus:{key:"segmentifyExtension",local:!0},clickedBanners:{key:"_sgf_clicked_banners",local:!1},nextPageQueue:{key:"_sgf_npq",local:!0},user:{key:"_sgf_user_id",local:!1},session:{key:"_sgf_session_id",local:!1}},logLevel:"ERROR",segmentifyObj:null,recommendedProducts:[],recommendedPromotions:[],waitingKeys:!1,keysTryCount:0,apiKey:null,skipProductDetail:{device:[]},offerRecommendedProducts:!1,offerRecommendedPromotions:!1,runTimer:null,initTimer:null,initTryCount:0,initTryLimit:50,isUnload:!1,cssPreload:!1,constants:{frequency:100,redirectDelay:1e3,retryLimit:3,eventTimeout:10,clickedBannersLimit:20,recommendationSelectorFindLimit:50},ga:{enabled:!1},requiredParams:{PAGE_VIEW:[],PRODUCT_VIEW:["productId"],BASKET_OPERATIONS:["productId","basketId","step"],CHECKOUT:["totalPrice","basketId","step"],USER_OPERATIONS:["step"],FORM:["formName","fields"],CUSTOM_EVENT:["type"],INTERACTION:["type"],BANNER_OPERATIONS:["type","title","group","order"],BANNER_GROUP_VIEW:["group"],INTERNAL_BANNER_GROUP:["group"],USER_CHANGE:["oldUserId"],PROMOTION:["type","code"],SEARCH:[],FILTER:["source"],COUPON:["type"]},optionalParams:{PAGE_VIEW:["category","subCategory"],PRODUCT_VIEW:["title","url","mUrl","image","imageXS","imageS","imageM","imageL","imageXL","additionalImages","mainCategory","category","categories","price","oldPrice","specialPrice","lastUpdateTime","inStock","stockCount","stockRatio","stockStatus","brand","gender","labels","sizes","allSizes","colors","publishTime","source","noUpdate","activeBanners","groupId"],BASKET_OPERATIONS:["price","quantity","size","activeBanners"],CHECKOUT:["productList","orderNo","paymentType","activeBanners","cartUrl","totalDiscount","discounts","shipment","tax","coupon"],USER_OPERATIONS:["username","fullName","phone","gender","birthDate","segments","memberSince","service","isRegistered","isLogin","location","emailNtf","mailTest","pushTest","custom"],FORM:[],CUSTOM_EVENT:[],INTERACTION:["interactionId","instanceId"],BANNER_OPERATIONS:["productId","category","brand","label"],BANNER_GROUP_VIEW:[],INTERNAL_BANNER_GROUP:["banners"],USER_CHANGE:[],PROMOTION:["title","url","mUrl","image","mImage","startDate","endDate","categories","brands","labels","productIds","publishTime"],SEARCH:["query"],FILTER:["productId","categories","brands","sizes","prices"],COUPON:[]},segmentifyApiUrl:"//gandalf.segmentify.com/",segmentifyCDNUrl:"//cdn.segmentify.com/",jQueryUrl:"//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",dataLayer:"sgfLayer",consumeDataLayer:!0,dataLayerConfig:{},categoryHierarchy:!1,disableNextPage:!1,language:"EN",currency:"",region:"",pushInfo:{dataCenter:""}},_loadJavascript:function(e,t,n){var a=document.createElement("script");return a.type="text/javascript",a.async=t,n&&"function"==typeof n&&(void 0!==a.onreadystatechange?a.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(n(),a.onreadystatechange=null)}:a.onload=n),a.src=e,document.getElementsByTagName("head")[0].appendChild(a),a},_loadCSS:function(e,t){var n=document.createElement("link");return n.type="text/css",_SgmntfY_._variables.cssPreload?(n.rel="preload",n.as="style"):n.rel="stylesheet",n.media="screen",t&&"function"==typeof t&&(void 0!==n.onreadystatechange?n.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||(t(),n.onreadystatechange=null)}:n.onload=t),n.href=e,document.getElementsByTagName("head")[0].appendChild(n),n},_actions:{_notificationWindow:function(params){var config={title:params.notificationTitle,vertical:"middle",horizontal:"center"},title=params.notificationTitle;switch(params.windowPosition){case"top":config.vertical="top";break;case"bottom":config.vertical="bottom";break;case"left":config.horizontal="left";break;case"right":config.horizontal="right";break;case"top-left":config.vertical="top",config.horizontal="left";break;case"top-right":config.vertical="top",config.horizontal="right";break;case"bottom-left":config.vertical="bottom",config.horizontal="left";break;case"bottom-right":config.vertical="bottom",config.horizontal="right"}var outerHtml=_SgmntfY_._getJq()('<div class="seg-popup seg-[[vertical]]-[[horizontal]] segFadeInUp fancybox-segmentify"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>'),notificationBody=_SgmntfY_._getJq()('<div class="fancybox-body" />').appendTo(outerHtml.find(".fancybox-inner"));params.html instanceof _SgmntfY_._getJq()?notificationBody.append(params.html):notificationBody.html(params.html);for(var button_overlay=_SgmntfY_._getJq()("<div />").appendTo(notificationBody),buttons=params.buttons||[],i=0;i<buttons.length;i++)_SgmntfY_._getJq()('<button data-newWindow="'+buttons[i].newWindow+'" data-target="'+buttons[i].buttonUrl+'" class="fancybox-button '+buttons[i].buttonColor+'">'+buttons[i].buttonTitle+"</button>").appendTo(button_overlay);"seamless"===params.windowStyle&&(title&&_SgmntfY_._getJq()('<div class="overlay-area-title" ><span>'+title+"</span></div>").appendTo(notificationBody),button_overlay.addClass("overlay-area-buttons").addClass("right"),title=null),"false"===params.isModal&&_SgmntfY_._getJq()('<span class="seg-popup-close"></span>').appendTo(outerHtml);var renderedHtml=_SgmntfY_._getMustache().render(outerHtml.prop("outerHTML"),config);_SgmntfY_._getJq()("body").prepend(renderedHtml),"true"===params.overlay&&(_SgmntfY_._getJq()('<div class="seg-popup-overlay"></div>').prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_._getJq()(".seg-popup-overlay").show()),"false"===params.isModal&&_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:params.instanceId,interactionId:params.instanceId})}),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body"));try{params.javascriptCode&&eval(params.javascriptCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing javascript code: "+e)}if(_SgmntfY_._getJq()(".seg-popup").find("form")){var $inner=_SgmntfY_._getJq()(".seg-popup .fancybox-body"),$form=$inner.find("form").eq(0);$form.bind("submit",function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","Popup Form button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:params.formName,instanceId:params.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:params.formName,fields:$form.sgmSerializeForm()}),$inner.html(params.successHtml),setTimeout(function(){$inner.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),$inner.parents(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)})}var redirectFn=function(e){var t=function(e,t){window.open(e.data("target"),t),e.parents(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)};"true"===e.data("newwindow")||!0===e.data("newwindow")?t(e,"_blank"):setTimeout(function(){t(e,"_self")},_SgmntfY_._variables.constants.redirectDelay)};_SgmntfY_._getJq()(".seg-popup .fancybox-button").click(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Window button click for actionId: "+params.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:_SgmntfY_._getJq()(this).text(),instanceId:params.instanceId}),redirectFn(_SgmntfY_._getJq()(this))}),_SgmntfY_._getJq()(".seg-popup a img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:params.instanceId,interactionId:params.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:params.instanceId,interactionId:params.instanceId})},notificationBanner:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.buttons=t,e.html=_SgmntfY_._getJq()('<div><a href="'+e.redirectUrl+'"><img id="sgm_img" src="'+e.imageUrl+'"></a></div>'),_SgmntfY_._actions._notificationWindow(e)},notificationMessage:function(e){var t=[];try{e.buttons&&(t=JSON.parse(e.buttons))}catch(n){_SgmntfY_.LOG_MESSAGE("WARN","Cannot parse buttons json, str: "+e.buttons),t=[]}e.html=e.notificationText,e.buttons=t,_SgmntfY_._actions._notificationWindow(e)},visitorForm:function(e){switch(e.actionType){case"INPAGE_WIDGET":(function e(){var t=this.params,n=this.selectorCount,a=t.selector;if(a&&_SgmntfY_._getJq()(a).length)try{a.addClass("sgm-recommendation sgm-clearcss").html(t.formHtml);var r=a.find("form").eq(0);r.submit(function(e){e.preventDefault(),_SgmntfY_.LOG_MESSAGE("DEBUG","In-page Form button click for actionId: "+t.actionId),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:t.formName,instanceId:t.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:t.formName,fields:r.sgmSerializeForm()}),setTimeout(function(){a.html(t.successHtml)},1e3)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in filling target element["+t.selector+"] with visitor form: "+e)}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),n<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var i=e.bind(this);setTimeout(i,100)}}).bind({params:e,selectorCount:1})();break;case"POPUP_WINDOW":default:e.html=e.formHtml,_SgmntfY_._actions._notificationWindow(e)}},recommendProducts:function(params,request){var previousMetadata={productId:request.originalParams.productId,productUrl:request.originalParams.productUrl,instanceId:params.instanceId};function dynamicItemKey(e){var t=e.recommendationSource;return void 0!==e.timeFrame&&_SgmntfY_._isNotEmpty(e.timeFrame)&&(t+="|"+e.timeFrame,void 0!==e.score&&_SgmntfY_._isNotEmpty(e.score)&&(t+="|"+e.score)),t}function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(dynamicItemKey(e[n])===t)return e[n].itemCount;return null}function checkProductInList(e,t){for(var n=0;n<e.length;n++)if(e[n].productId==t)return!0;return!1}function isElemVisible(e){try{if(_SgmntfY_._exists(e)&&"none"!==e.css("display")){var t=_SgmntfY_._getJq()(window),n=t.scrollTop(),a=n+t.height();e instanceof HTMLElement?e=_SgmntfY_._getJq()(e):e instanceof HTMLCollection&&(e=_SgmntfY_._getJq()(e[0]));var r=e.offset().top;return r+100<=a&&r>=n}return!1}catch(e){return!1}}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:notificationTitle,products:productList,index:function(){return++renderIdx},discount:function(){try{var e=this.price,t=this.oldPrice;if(!e||!t||e==t)return null;var n=100-100*e/t;return n>0&&Math.round(n)}catch(e){return null}},commaFormatPrice:function(){return this.toFixed(2).toString().replace(/\./g,",")},dotFormatPrice:function(){return this.toFixed(2).toString()}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId})}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}var productList=[],recommendedProducts=params.recommendedProducts||{},dynamicItems=JSON.parse(params.dynamicItems)||[],recoVersion=params.version||"v1";if("v1"===recoVersion)if("SHUFFLE"===params.ordering){function allNull(e){for(var t in e)if(e.hasOwnProperty(t)&&(void 0!==e[t]||null!==e[t]))return!1;return!0}function arrayRandom(){return parseInt(100*Math.random())}function randomInt(e,t){return Math.floor(Math.random()*(t-e))+e}var itemCounts=[],dynamicLengths=[];for(var idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){itemCounts.push(parseInt(dynamicItems[idx].itemCount||0));var source=dynamicItemKey(dynamicItems[idx]);recommendedProducts.hasOwnProperty(source)?dynamicLengths.push(recommendedProducts[source].length):dynamicLengths.push(0)}var firstLevel=[],firstLevelTotal=itemCounts.reduce(function(e,t){return e+t},0);for(idx in itemCounts)if(itemCounts.hasOwnProperty(idx)){var _idx=parseInt(idx);if(_idx===itemCounts.length-1)firstLevel.push(100);else{var pct=parseInt(itemCounts[idx]/firstLevelTotal*100);0===_idx?firstLevel.push(pct):firstLevel.push(firstLevel[firstLevel.length-1]+pct)}}var secondLevel=[];for(var dl in dynamicLengths)if(dynamicLengths.hasOwnProperty(dl)){for(var len=dynamicLengths[dl],sumOfSquares=len*(len+1)*(2*len+1)/6,tmpArr=[],l=len;l>0;--l)1===l?tmpArr.push(100):(pct=parseInt(Math.pow(l,2)/sumOfSquares*100),l===len?tmpArr.push(pct):tmpArr.push(tmpArr[tmpArr.length-1]+pct));secondLevel.push(tmpArr)}for(var dynamicProducts=[],iteration=0;!(++iteration>1e4||dynamicProducts.length>=firstLevelTotal);){var allNullCheck=!0;for(idx in dynamicItems)if(dynamicItems.hasOwnProperty(idx)){source=dynamicItemKey(dynamicItems[idx]);var tmpCheck=!0;if(recommendedProducts.hasOwnProperty(source)&&(tmpCheck=allNull(recommendedProducts[source])),!tmpCheck){allNullCheck=!1;break}}if(allNullCheck)break;var rand=arrayRandom(),firstLevelIndex=-1;for(var fl in firstLevel)if(firstLevel.hasOwnProperty(fl)&&rand<firstLevel[fl]){firstLevelIndex=parseInt(fl);break}if(-1!==firstLevelIndex&&dynamicItems.hasOwnProperty(firstLevelIndex.toString())){source=dynamicItemKey(dynamicItems[firstLevelIndex]),rand=arrayRandom();var secondLevelIndex=-1;for(var sl in secondLevel[firstLevelIndex])if(secondLevel[firstLevelIndex].hasOwnProperty(sl)&&rand<secondLevel[firstLevelIndex][sl]){secondLevelIndex=parseInt(sl);break}if(-1!==secondLevelIndex&&recommendedProducts[source].hasOwnProperty(secondLevelIndex.toString())){var candidate=recommendedProducts[source].splice(secondLevelIndex,1)[0];if(null!=candidate){recommendedProducts[source].splice(secondLevelIndex,0,null);var eliminationFuncRetVal=!1;if(params.eliminationFunction){var func=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof func)try{eliminationFuncRetVal=func.call(null,candidate)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFuncRetVal){candidate.name=_SgmntfY_._decodeHtml(candidate.name);var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[firstLevelIndex].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[firstLevelIndex].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,candidate.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(candidate.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId));break;case"NO_ELIMINATION":default:productList.push(candidate),dynamicProducts.push(candidate),sourceLastVisited||_SgmntfY_._addRecommendedProduct(candidate.productId)}}}}}}for(var i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.splice(randomInt(0,productList.length),0,elm)}}else{for(var missingCount=0,i=0;i<recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedProducts.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var ri=0;ri<dynamicItems.length;++ri){var curRecommendationSource=dynamicItemKey(dynamicItems[ri]),curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedProducts.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[curRecommendationSource].length;++i){var elm=recommendedProducts[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation elimination js function: "+e)}}if(!eliminationFnRetVal){var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItems[ri].recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItems[ri].recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}}else if("v3"===recoVersion&&recommendedProducts.length){for(var staticProducts=recommendedProducts[0]||[],i=0;i<staticProducts.length;++i){var elm=staticProducts[i];checkProductInList(productList,elm.productId)||productList.push(elm)}for(var missingCount=0,ri=1;ri<recommendedProducts.length;++ri){var dynamicItem=dynamicItems[ri-1],curCatItemCount=parseInt(dynamicItem.itemCount);if(isNaN(curCatItemCount)&&(curCatItemCount=0),curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedProducts[ri].length;++i){var elm=recommendedProducts[ri][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0===missingCount)break;var sourceLastVisited="RECOMMENDATION_SOURCE_LAST_VISITED"===dynamicItem.recommendationSource||"RECOMMENDATION_EVENT_DATA"===dynamicItem.recommendationSource;switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkProductInList(productList,elm.productId)||(sourceLastVisited||!_SgmntfY_._containsRecommendedProduct(elm.productId)||_SgmntfY_._variables.offerRecommendedProducts)&&(productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount);break;case"NO_ELIMINATION":default:productList.push(elm),sourceLastVisited||_SgmntfY_._addRecommendedProduct(elm.productId),++index,--missingCount}}}}}var notificationTitleMap=JSON.parse(params.notificationTitleMap||"{}"),notificationTitle=notificationTitleMap[request.data.lang]||params.notificationTitle;if(0!==productList.length){"INPAGE_WIDGET"!==params.actionType&&"POPUP_RECO"!==params.actionType&&_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(notificationTitle,productList,previousMetadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context();break;case"JAVASCRIPT_FUNCTION":var fx=_SgmntfY_._getObjectByString(window,params.jsFunction);if("function"==typeof fx)try{fx.call(null,notificationTitle,productList,previousMetadata,wvCB)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation js function: "+e)}else _SgmntfY_.LOG_MESSAGE("WARN","Product Recommendation javascript function("+params.jsFunction+") does not exist");break;case"POPUP_RECO":var config={title:params.notificationTitle,vertical:params.verticalPosition,horizontal:params.horizontalPosition};if(productList.length<3)return;config.products=productList;try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!");_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId})}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var _products=[],_productId="";request.originalParams&&request.originalParams.params&&(_productId=request.originalParams.params.productId||"");for(var i=0;i<config.products.length&&3!==_products.length;++i){var _product=config.products[i];_product.productId!==_productId&&_products.push(_product)}if(3!==_products.length)return;config.products=_products;var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),params.cssCode&&_SgmntfY_._getJq()("<style />").html(params.cssCode).prependTo(_SgmntfY_._getJq()("body"));try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===params.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:params.interactionId,instanceId:params.instanceId})}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback(notificationTitle,[],previousMetadata,null)},recommendPromotion:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame===t)return e[n].itemCount;return null}function checkPromotionInList(e,t){for(var n=0;n<e.length;n++)if(e[n].code===t)return!0;return!1}function isElemVisible(e){try{if(_SgmntfY_._exists(e)){var t=_SgmntfY_._getJq()(window),n=t.scrollTop(),a=n+t.height();e instanceof HTMLElement?e=_SgmntfY_._getJq()(e):e instanceof HTMLCollection&&(e=_SgmntfY_._getJq()(e[0]));var r=e.offset().top;return r+100<=a&&r>=n}return!1}catch(e){return!1}}function checkSelectorAndRender(){var params=this.params,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){var renderIdx=0,reConf={title:params.notificationTitle,promotionList:promotionList,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation pre js code: "+e)}reConf.brandingEnabled&&(reConf.title+='<a target="_blank" class="seg-rec-logo" href="//www.segmentify.com">Recommended by <img src="//cdn.segmentify.com/images/sgm-logo.svg" /></a>');var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.addClass("seg-promotion-wrapper").html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-promotion-wrapper"});"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with promotion recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation post js code: "+e)}}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var promotionList=[],recommendedPromotions=params.recommendedPromotions||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedPromotions.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkPromotionInList(promotionList,elm.code)||promotionList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedPromotions.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedPromotions[curRecommendationSource].length;++i){var elm=recommendedPromotions[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;var eliminationFnRetVal=!1;if(params.eliminationFunction){var fx=_SgmntfY_._getObjectByString(window,params.eliminationFunction);if("function"==typeof fx)try{eliminationFnRetVal=fx.call(null,elm)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing promotion recommendation elimination js function: "+e)}}if(!eliminationFnRetVal)switch(params.elimination){case"ELIMINATE_DUPLICATES":case"ELIMINATE_PREVIOUS":checkPromotionInList(promotionList,elm.code)||_SgmntfY_._containsRecommendedPromotion(elm.code)&&!_SgmntfY_._variables.offerRecommendedPromotions||(promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount);break;case"NO_ELIMINATION":default:promotionList.push(elm),_SgmntfY_._addRecommendedPromotion(elm.code),++index,--missingCount}}}}if(0!==promotionList.length){"SHUFFLE"===params.ordering&&(promotionList=_SgmntfY_._shuffle(promotionList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(promotionList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,selectorCount:1});binded_context()}}else"CALLBACK"===params.actionType&&request.recommendationCallback&&request.recommendationCallback([],metadata,null)},recommendKeyword:function(params,request){var metadata={title:params.notificationTitle};function checkDynamicItemCount(e,t){for(var n=0;n<e.length;++n)if(e[n].recommendationSource+"|"+e[n].timeFrame==t)return e[n].itemCount;return null}function checkKeywordInList(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1}function isElemVisible(e){try{if(_SgmntfY_._exists(e)){var t=_SgmntfY_._getJq()(window),n=t.scrollTop(),a=n+t.height();e instanceof HTMLElement?e=_SgmntfY_._getJq()(e):e instanceof HTMLCollection&&(e=_SgmntfY_._getJq()(e[0]));var r=e.offset().top;return r+100<=a&&r>=n}return!1}catch(e){return!1}}function checkSelectorAndRender(){var params=this.params,keywordList=this.keywordList,selectorCount=this.selectorCount,target=params.selector;if(target&&_SgmntfY_._getJq()(target).length){for(var keywords=[],k=0;k<keywordList.length;++k)keywords.push({name:keywordList[k],url:""});var recoTitle=params.notificationTitle,renderIdx=0,reConf={title:recoTitle,keywords:keywords,index:function(){return++renderIdx}};try{if(params.preJsCode){eval(params.preJsCode);var retVal=preRenderConf(reConf);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(params.recommendationTemplate,reConf);try{var targetElement=_SgmntfY_._getJq()(target).first();if("SELF"===params.insertType)targetElement.html(renderedHtml),wvCB&&wvCB(targetElement);else{var $div=_SgmntfY_._getJq()("<div/>",{class:"seg-reco-wrapper seg-clear"});"AFTER"===params.insertType||"BEFORE"===params.insertType?"AFTER"===params.insertType?$div.html(renderedHtml).insertAfter(targetElement):$div.html(renderedHtml).insertBefore(targetElement):"APPEND"!==params.insertType&&"PREPEND"!==params.insertType||("APPEND"===params.insertType?$div.html(renderedHtml).appendTo(targetElement):$div.html(renderedHtml).prependTo(targetElement)),wvCB&&wvCB($div)}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+target+"] with product recommendations: "+e)}try{params.postJsCode&&eval(params.postJsCode)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product recommendation post js code: "+e)}_SgmntfY_._getJq()(".seg-label a").on("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",interactionId:params.actionId,instanceId:params.instanceId})})}else if(_SgmntfY_.LOG_MESSAGE("WARN","Error in finding target element["+target+"], element does not exist"),selectorCount<_SgmntfY_._variables.constants.recommendationSelectorFindLimit){++this.selectorCount;var binded=checkSelectorAndRender.bind(this);setTimeout(binded,100)}}for(var keywordList=[],recommendedKeywords=params.recommendedKeywords||{},dynamicItems=JSON.parse(params.dynamicItems)||[],i=0;i<recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS.length;++i){var elm=recommendedKeywords.RECOMMENDATION_SOURCE_STATIC_ITEMS[i];checkKeywordInList(keywordList,elm)||keywordList.push(elm)}for(var missingCount=0,ri=0;ri<dynamicItems.length;++ri){void 0===dynamicItems[ri].timeFrame&&(dynamicItems[ri].timeFrame="null");var curRecommendationSource=dynamicItems[ri].recommendationSource+"|"+dynamicItems[ri].timeFrame,curCatItemCount=parseInt(checkDynamicItemCount(dynamicItems,curRecommendationSource));if(isNaN(curCatItemCount)&&(curCatItemCount=0),recommendedKeywords.hasOwnProperty(curRecommendationSource)&&curCatItemCount){missingCount+=curCatItemCount;for(var index=0,i=0;i<recommendedKeywords[curRecommendationSource].length;++i){var elm=recommendedKeywords[curRecommendationSource][i];if(elm.name=_SgmntfY_._decodeHtml(elm.name),index>=curCatItemCount&&0==missingCount)break;keywordList.push(elm),++index,--missingCount}}}if(0!==keywordList.length){"SHUFFLE"===params.ordering&&(keywordList=_SgmntfY_._shuffle(keywordList)),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:params.actionId,instanceId:params.instanceId});var wvInteractionId=params.interactionId,wvInstanceId=params.instanceId,wvCB=function(e){var t=!1;if(!t&&isElemVisible(e))_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0;else if(!t)var n=setInterval(function(){!t&&isElemVisible(e)&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:wvInteractionId,instanceId:wvInstanceId}),t=!0,window.clearInterval(n))},100)};switch(params.actionType){case"CALLBACK":request.recommendationCallback&&request.recommendationCallback(keywordList,metadata,wvCB);break;case"INPAGE_WIDGET":var binded_context=checkSelectorAndRender.bind({params:params,keywordList:keywordList,selectorCount:1});binded_context()}}else request.recommendationCallback&&request.recommendationCallback([],metadata,null)},webNotification:function(e){},redirectUrl:function(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Redirecting action to url: "+e.redirectUrl),window.location=e.redirectUrl},jsFunctionCall:function(e){e.actionType="JAVASCRIPT_FUNCTION",_SgmntfY_._actions.jsAction(e)},jsAction:function(params){var actionType=params.actionType;switch(actionType){case"JAVASCRIPT_EVENT":var event=params.event,parameters=[];try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Event Trigger) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),_SgmntfY_._getJq()(document).trigger(event,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Event Trigger) - Triggered Event: "+event);break;case"JAVASCRIPT_CODE":try{eval(params.javascriptCode),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Execute Code) successfully executed")}catch(e){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId}),_SgmntfY_.LOG_MESSAGE("WARN","Error in JS Action (Execute Code): "+e)}break;case"JAVASCRIPT_FUNCTION":default:var fx=window[params.function],parameters=[];if("function"==typeof fx){try{params.parameters&&(parameters=JSON.parse(params.parameters))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) - Cannot parse parameters json, str: "+params.parameters),parameters=[]}parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_success",interactionId:params.actionId,instanceId:params.instanceId})}),parameters.push(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"js_reject",interactionId:params.actionId,instanceId:params.instanceId})}),fx.apply(null,parameters),_SgmntfY_.LOG_MESSAGE("DEBUG","Js Action (Function Call) successfully run for function: "+params.function)}else _SgmntfY_.LOG_MESSAGE("WARN","Js Action (Function Call) failed, non existing function: "+params.function)}},jsCountdownTimer:function(e){var t=e.timeout;_SgmntfY_.LOG_MESSAGE("DEBUG","Starting countdown timer with "+1e3*(t||0)+" second(s)"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("DEBUG","Countdown timer finished after "+1e3*(t||0)+" second(s)"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"timeout",interactionId:e.actionId,instanceId:e.instanceId})},1e3*(t||0))},sendBannerDetails:function(e,t){var n=t.originalParams;n.group=e.group;var a=[],r=_SgmntfY_._functions.bannerGroupDetail(n);r&&a.push(r),_SgmntfY_._sendRequestToServer(a)}},_campaigns:{NEWSLETTER:function(campaign,request){var config={title:campaign.title,description:campaign.description,placeholder:campaign.placeholder,termsUrl:campaign.termsUrl,termsText:campaign.termsText,buttonSubmitText:campaign.buttonSubmitText,buttonThanksText:campaign.buttonThanksText,buttonBgColor:campaign.buttonBgColor,buttonTextColor:campaign.buttonTextColor,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Newsletter popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove()},1e3)}),_SgmntfY_._getJq()(".seg-form-submit").bind("click",function(e){_SgmntfY_._getJq()(".seg-form-input").removeClass("seg-form-invalid"),_SgmntfY_._getJq()(".seg-email-collection .seg-checkbox").removeClass("seg-form-invalid"),e.preventDefault();var t=_SgmntfY_._getJq()(".seg-form-input"),n=_SgmntfY_._getJq()('.seg-email-collection .seg-form-footer input[type="checkbox"]');if(isEmail(t.val())&&1==n.is(":checked")){_SgmntfY_._getJq()(this).addClass("seg-sending"),_SgmntfY_._getJq()(this).css({"pointer-events":"none"}),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").addClass("segFadeOutDown")},3e3),setTimeout(function(){_SgmntfY_._getJq()(".seg-email-collection").remove()},6e3);var a=_SgmntfY_._getJq()("#seg-email-collection");a.length>0&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:campaign.name,instanceId:campaign.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm()}))}isEmail(t.val())||t.addClass("seg-form-invalid"),0==n.is(":checked")&&_SgmntfY_._getJq()(".seg-terms .seg-checkbox").addClass("seg-form-invalid")});var isEmail=function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}},FORM:function(campaign,request){for(var config={title:campaign.title,description:campaign.description,buttonSubmitText:campaign.buttonSubmitText,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition},fields=campaign.fields||[],i=0;i<fields.length;++i){var field=fields[i];config["ff"+i+"_required"]=field.required,"INPUT"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,config["ff"+i+"_inputType"]=field.inputType,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="input-"+i):"TEXT_AREA"===field.type?(config["ff"+i+"_name"]=field.name,config["ff"+i+"_placeholder"]=field.placeholder,field.name?config["ff"+i+"_fieldName"]=field.name:config["ff"+i+"_fieldName"]="textarea-"+i):"CHECKBOX"!==field.type&&"RADIO_BUTTON"!==field.type||(config["ff"+i+"_groupTitle"]=field.groupTitle,config["ff"+i+"_options"]=field.options,field.groupTitle?config["ff"+i+"_fieldName"]=field.groupTitle:"CHECKBOX"===field.type?config["ff"+i+"_fieldName"]="checkbox-"+i:config["ff"+i+"_fieldName"]="radiobutton-"+i)}try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Form popup appended to html body for campaign("+campaign.instanceId+")"),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-form-survey").each(function(){var e=_SgmntfY_._getJq()(this);-1===e.attr("class").indexOf("cmp_")&&e.addClass(campaign.instanceId)}),"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3)}),_SgmntfY_._getJq()("."+campaign.instanceId+" .seg-form-submit").bind("click",function(e){e.preventDefault();var t=_SgmntfY_._getJq()(this),n=_SgmntfY_._getJq()("."+campaign.instanceId+".seg-form-survey"),a=n.find(".seg-form");checkValidity(a)&&(t.addClass("seg-sending"),t.css({"pointer-events":"none"}),setTimeout(function(){n.addClass("seg-popup-thanks").removeClass("segFadeInUp")},1300),setTimeout(function(){n.addClass("segFadeOutDown")},3e3),setTimeout(function(){n.remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},6e3),a.length>0&&(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"submit",interactionId:campaign.name,instanceId:campaign.instanceId}),_SgmntfY_._variables.segmentifyObj("user:form",{formName:campaign.name,fields:a.sgmSerializeForm()})))});var checkValidity=function(e){try{e.find(".seg-form-invalid").removeClass("seg-form-invalid");for(var t=e.find("input,textarea"),n=!0,a=0;a<t.length;++a){var r=t[a],i=_SgmntfY_._getJq()(r);"checkbox"!==i.attr("type")&&(r.checkValidity()||("radio"===i.attr("type")?i.parent().addClass("seg-form-invalid"):i.addClass("seg-form-invalid"),n=!1))}var s=e.find('input[type="checkbox"]'),o=[];s.each(function(){-1==o.indexOf(this.name)&&o.push(this.name)});for(var _=0;_<o.length;++_)e.find('input[name="'+o[_]+'"]:required').length>0&&0==e.find('input[name="'+o[_]+'"]:checked').length&&(e.find('input[name="'+o[_]+'"]').parent().addClass("seg-form-invalid"),n=!1);return n}catch(e){return!0}}},POPUP_BANNER:function(campaign,request){var config={title:campaign.title,image:campaign.image,url:campaign.url,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._getJq()(".seg-banner-container img").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId})},POPUP_RECOMMENDATION:function(campaign,request){for(var config={title:campaign.title,vertical:campaign.verticalPosition,horizontal:campaign.horizontalPosition},productsList=campaign.productsList||[],products=[],i=0;i<productsList.length;++i)for(var j=0;j<productsList[i].length;++j)products.push(productsList[i][j]);if(!(products.length<3)){"SHUFFLE"===campaign.ordering&&(products=_SgmntfY_._shuffle(products)),config.products=products;try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var _products=[],_productId="";request.originalParams&&request.originalParams.params&&(_productId=request.originalParams.params.productId||"");for(var i=0;i<config.products.length&&3!==_products.length;++i){var _product=config.products[i];_product.productId!==_productId&&_products.push(_product)}if(3===_products.length){config.products=_products;var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}"true"===campaign.overlay&&_SgmntfY_._getJq()(".seg-popup-overlay").show(),_SgmntfY_._getJq()(".seg-popup-close").bind("click",function(){var e=_SgmntfY_._getJq()(this);e.parent(".seg-popup").removeClass("segFadeInUp").addClass("segFadeOutDown"),window.setTimeout(function(){e.parent(".seg-popup").remove(),_SgmntfY_._getJq()(".seg-popup-overlay").remove()},1e3),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"close",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}}},NOTIFICATION_BAR:function(campaign,request){var config={title:campaign.title,image:campaign.image,bgColor:campaign.bgColor,textColor:campaign.textColor,url:campaign.url,instanceId:campaign.instanceId,divClass:"sgf-notif-bar-"+(campaign.verticalPosition||"top")};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}var renderedHtml=_SgmntfY_._getMustache().render(campaign.html,config);_SgmntfY_._getJq()("body").prepend(renderedHtml),campaign.css&&_SgmntfY_._getJq()("<style />").html(campaign.css).prependTo(_SgmntfY_._getJq()("body"));try{campaign.postJs&&eval(campaign.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign post js code: "+e)}_SgmntfY_.LOG_MESSAGE("DEBUG","Notification Bar appended to html body for campaign("+campaign.instanceId+")"),"true"===campaign.sticky&&(_SgmntfY_._getJq()(".seg-notification-bar").addClass("seg-notification-bar-sticky"),_SgmntfY_._getJq()(".seg-notification-bar-sticky:not([data-loaded])").each(function(){var e=_SgmntfY_._getJq()(this);if(e.attr("data-loaded","true"),e.find("img").length){var t=e.find("img:first"),n=t.attr("src")||t.attr("data-src");t.on("load",function(){var e=_SgmntfY_._getJq()(this).parents(".seg-notification-bar:first"),t=parseInt(_SgmntfY_._getJq()("body").css("padding-top").replace("px","")),n=parseInt(_SgmntfY_._getJq()("body").css("padding-bottom").replace("px",""));e.hasClass("sgf-notif-bar-top")?t+=e.height():e.hasClass("sgf-notif-bar-bottom")&&(n+=e.height()),_SgmntfY_._getJq()("body").css("padding-top",t).css("padding-bottom",n)}),t[0].src=n}})),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",instanceId:campaign.instanceId,interactionId:campaign.instanceId}),_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).length?_SgmntfY_._getJq()(".seg-notification-bar-v2-"+campaign.instanceId).bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})}):_SgmntfY_._getJq()(".sgf-link").bind("click",function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"click",instanceId:campaign.instanceId,interactionId:campaign.instanceId})})},PUSH_PERMISSION:function(campaign,request){var config={title:campaign.title,text:campaign.text,icon:campaign.icon,buttonLaterText:campaign.buttonLaterText,buttonAllowText:campaign.buttonAllowText,safariEnabled:campaign.safariEnabled};try{if(campaign.preJs){eval(campaign.preJs);var retVal=preRenderConf(config);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing campaign pre js code: "+e)}try{var _pushPermissionKey=_SgmntfY_._getPersistentData(_SgmntfY_._variables.pushPermissionKey);if(_pushPermissionKey&&_SgmntfY_._isNotEmpty(_pushPermissionKey)&&"true"===_pushPermissionKey)return;var frequency=campaign.frequency;frequency&&("SESSION"===frequency.type?_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",0):"LIFETIME"===frequency.type?_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",390):"DAYS"===frequency.type&&_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",frequency.param))}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while checking campaign frequency:"+e),_SgmntfY_._storePersistentData(_SgmntfY_._variables.pushPermissionKey,"true",0)}try{campaign.postJs&&eval(campaign.postJs),/OPR/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Opera":/YaBrowser/i.test(navigator.userAgent)||/Yowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Yandex":/SamsungBrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Samsung":/ucbrowser/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="UCBrowser":/Chrome/i.test(navigator.userAgent)?_SgmntfY_._variables.pushInfo.agent="Chrome":/Firefox/i.test(navigator.userAgent)&&(_SgmntfY_._variables.pushInfo.agent="Firefox"),"safari"in window&&"pushNotification"in window.safari&&(_SgmntfY_._variables.pushInfo.agent="Safari"),"Chrome"!==_SgmntfY_._variables.pushInfo.agent&&"Opera"!==_SgmntfY_._variables.pushInfo.agent&&"Yandex"!==_SgmntfY_._variables.pushInfo.agent&&"Samsung"!==_SgmntfY_._variables.pushInfo.agent&&"UCBrowser"!==_SgmntfY_._variables.pushInfo.agent&&"Firefox"!==_SgmntfY_._variables.pushInfo.agent||(_SgmntfY_._variables.pushInfo.isFirebaseCompatible=!0),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod&&_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&_SgmntfY_._getJq().getScript(_SgmntfY_._variables.pushInfo.firebase.scriptUrl,function(){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&(firebase.apps.length||firebase.initializeApp({apiKey:_SgmntfY_._variables.pushInfo.firebase.apiKey,messagingSenderId:_SgmntfY_._variables.pushInfo.firebase.messagingSenderId}),_SgmntfY_._variables.pushInfo.messaging=firebase.messaging()),"serviceWorker"in navigator&&navigator.serviceWorker.register(_SgmntfY_._variables.pushInfo.permissionDomain).then(function(e){_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&firebase.messaging().useServiceWorker(e),_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker "+e)})}),"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._pushInitPermissionCampaign(campaign,config),"Safari"!==_SgmntfY_._variables.pushInfo.agent&&"Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod&&"serviceWorker"in navigator&&navigator.serviceWorker.register(_SgmntfY_._variables.pushInfo.permissionDomain).then(function(e){_SgmntfY_._variables.pushInfo.serviceWorkerReg=e,_SgmntfY_._pushInitPermissionCampaign(campaign,config)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while registering service worker in vapid method"+e)})}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while executing PUSH_PERMISSION campaign "+e)}}},_functions:{getFunction:function(e){switch(e.toLowerCase()){case"apikey":return _SgmntfY_._functions.setApiKey;case"loglevel":return _SgmntfY_._functions.setLogLevel;case"variables":return _SgmntfY_._functions.setVariables;case"userid":return _SgmntfY_._functions.setUserId;case"view:page":return _SgmntfY_._functions.pageView;case"view:product":return _SgmntfY_._functions.productView;case"basket:add":return _SgmntfY_._functions.addToBasket;case"basket:remove":return _SgmntfY_._functions.removeFromBasket;case"basket:clear":return _SgmntfY_._functions.clearBasket;case"checkout:basket":return _SgmntfY_._functions.checkoutViewBasket;case"checkout:customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"checkout:payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"checkout:purchase":return _SgmntfY_._functions.checkoutPurchase;case"user:signin":return _SgmntfY_._functions.userSignIn;case"user:signout":return _SgmntfY_._functions.userSignOut;case"user:signup":return _SgmntfY_._functions.userSignUp;case"user:subscribe":return _SgmntfY_._functions.userSubscribe;case"user:unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"user:update":return _SgmntfY_._functions.userInfoUpdate;case"event:custom":return _SgmntfY_._functions.customEvent;case"event:interaction":return _SgmntfY_._functions.interaction;case"user:form":return _SgmntfY_._functions.userForm;case"banner:impression":return _SgmntfY_._functions.bannerImpression;case"banner:click":return _SgmntfY_._functions.bannerClick;case"banner:update":return _SgmntfY_._functions.bannerUpdate;case"bannergroup:view":return _SgmntfY_._functions.bannerGroupView;case"bannergroup:detail":return _SgmntfY_._functions.bannerGroupDetail;case"impression:promotion":return _SgmntfY_._functions.promotionImpression;case"view:promotion":return _SgmntfY_._functions.promotionView;case"push:click:interaction":return _SgmntfY_._functions.pushInteraction;case"search":return _SgmntfY_._functions.search;case"filter":return _SgmntfY_._functions.filter;case"coupon":return _SgmntfY_._functions.coupon;default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},getDataLayerFunction:function(e,t){switch(e.toLowerCase()){case"page":return _SgmntfY_._functions.pageView;case"product":return _SgmntfY_._functions.productView;case"basket":switch(t.step.toLowerCase()){case"add":return _SgmntfY_._functions.addToBasket;case"remove":return _SgmntfY_._functions.removeFromBasket;case"clear":return _SgmntfY_._functions.clearBasket;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Basket Operations Step: "+e.step)}}case"checkout":switch(t.step.toLowerCase()){case"basket":return _SgmntfY_._functions.checkoutViewBasket;case"customer":return _SgmntfY_._functions.checkoutCustomerInfo;case"payment":return _SgmntfY_._functions.checkoutPaymentInfo;case"purchase":return _SgmntfY_._functions.checkoutPurchase;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Checkout Step: "+e.step)}}case"user":switch(t.step.toLowerCase()){case"signin":return _SgmntfY_._functions.userSignIn;case"signout":return _SgmntfY_._functions.userSignOut;case"signup":return _SgmntfY_._functions.userSignUp;case"subscribe":return _SgmntfY_._functions.userSubscribe;case"unsubscribe":return _SgmntfY_._functions.userUnsubscribe;case"update":return _SgmntfY_._functions.userInfoUpdate;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected User Operations Step: "+e.step)}}case"interaction":return _SgmntfY_._functions.interaction;case"form":return _SgmntfY_._functions.userForm;case"banners":return _SgmntfY_._functions.bannerGroupView;case"banner":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.bannerImpression;case"click":return _SgmntfY_._functions.bannerClick;case"update":return _SgmntfY_._functions.bannerUpdate;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Banner Operations Type: "+e.type)}}case"custom":return _SgmntfY_._functions.customEvent;case"promotion":switch(t.type.toLowerCase()){case"impression":return _SgmntfY_._functions.promotionImpression;case"view":return _SgmntfY_._functions.promotionView;default:return function(e){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Promotion Type: "+e.type)}}default:return function(t){_SgmntfY_.LOG_MESSAGE("WARN","Unexpected Command: "+e)}}},callFunction:function(e){var t=[];e=e||[];for(var n=0;n<e.length;n++){var a=e[n],r=_SgmntfY_._functions.getFunction(a[0]),i=Array.prototype.slice.call(a,1);try{var s=r.apply(null,i);s&&(t=t.concat(s)),_SgmntfY_.LOG_MESSAGE("INFO","Event triggered: "+a[0])}catch(e){_SgmntfY_.LOG_MESSAGE("Error","Can't convert command("+a[0]+") into request data. Details: "+e)}}_SgmntfY_._sendRequestToServer(t)},setApiKey:function(e,t){if(_SgmntfY_._variables.apiKey=e,_SgmntfY_.LOG_MESSAGE("DEBUG","Api Key: "+e),t)_SgmntfY_.LOG_MESSAGE("INFO","Account specific style is disabled, skipping...");else{var n=_SgmntfY_._variables.segmentifyCDNUrl+e+"/segmentify.css";_SgmntfY_.LOG_MESSAGE("INFO","Loading account specific css file: "+n),_SgmntfY_._loadCSS(n)}_SgmntfY_._isNotEmpty(_SgmntfY_._variables.apiKey)&&(_SgmntfY_._consumeNextPageQueue(),_SgmntfY_._consumeRetryQueue())},setLogLevel:function(e){var t=_SgmntfY_.LOG_LEVELS[e];void 0!==t&&(_SgmntfY_._variables.logLevel=t,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Log Level Changed to: "+e))},setVariables:function(e){e=e||{},_SgmntfY_._extend(_SgmntfY_._variables,e),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Variables are updated - New Values: "+e)},setUserId:function(e){var t=_SgmntfY_._getUserId();if(_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,e,390,_SgmntfY_._variables.storage.user.local),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify User Id Changed to: "+e),t!==e){var n={};return n.oldUserId=t||"",n.async="false",_SgmntfY_._prepareRequest(n,"USER_CHANGE")}},pageView:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"PAGE_VIEW")},productView:function(e){if((e=e||{}).url=_SgmntfY_._clearProductUrl(e.url||document.URL),e.productUrl=e.productUrl||e.url||document.URL,"number"==typeof e.productId&&(e.productId=e.productId.toString()),"string"==typeof e.categories)if(-1!==e.categories.indexOf("|")){var t=e.categories.split("|");for(var n in e.categories=[],t)t.hasOwnProperty(n)&&e.categories.push(t[n].trim())}else e.categories=[e.categories];else for(var a in e.categories)e.categories.hasOwnProperty(a)&&"string"==typeof e.categories[a]&&(e.categories[a]=e.categories[a].trim());e.categories=(e.categories||[]).filter(_SgmntfY_._null),e.source=e.source||_SgmntfY_._sourceOfUrl();var r=_SgmntfY_._getClickedBanners();if(r.length>0){var i=[];for(a=0;a<r.length;++a){var s=_SgmntfY_._split(r[a],":",4);4!==s.length||isNaN(parseInt(s[2]))||i.push({title:s[0],group:s[1],order:parseInt(s[2])})}e.activeBanners=i}return _SgmntfY_._variables.skipProductDetail.device.indexOf(_SgmntfY_._variables.ua.type)>=0&&(e.noUpdate=["all"]),_SgmntfY_._prepareRequest(e,"PRODUCT_VIEW")},addToBasket:function(e){(e=e||{}).step="add",e.async="false",e.quantity=e.quantity||1;var t=_SgmntfY_._getClickedBanners();if(t.length>0){for(var n=[],a=0;a<t.length;++a){var r=_SgmntfY_._split(t[a],":",4);4!==r.length||isNaN(parseInt(r[2]))||n.push({title:r[0],group:r[1],order:parseInt(r[2])})}e.activeBanners=n}return _SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},removeFromBasket:function(e){return(e=e||{}).step="remove",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},clearBasket:function(e){return(e=e||{}).step="clear",e.async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"BASKET_OPERATIONS")},checkoutViewBasket:function(e){if((e=e||{}).step="view-basket",e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;return e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutCustomerInfo:function(e){return(e=e||{}).step="customer-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPaymentInfo:function(e){return(e=e||{}).step="payment-info",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),_SgmntfY_._prepareRequest(e,"CHECKOUT")},checkoutPurchase:function(e){if((e=e||{}).step="purchase",e.basketId=e.basketId||"basket_"+_SgmntfY_._getUserId(),e.hasOwnProperty("productList"))for(var t=0;t<e.productList.length;++t)e.productList[t].quantity=e.productList[t].quantity||1;var n=_SgmntfY_._getClickedBanners();if(n.length>0){for(var a=[],r=0;r<n.length;++r){var i=_SgmntfY_._split(n[r],":",4);4!==i.length||isNaN(parseInt(i[2]))||a.push({title:i[0],group:i[1],order:parseInt(i[2])})}e.activeBanners=a}return _SgmntfY_._prepareRequest(e,"CHECKOUT")},userSignIn:function(e){return(e=e||{}).step="signin",e.async="false",e.isLogin=!0,e.isRegistered=!0,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignOut:function(e){return(e=e||{}).step="signout",e.async="false",e.isLogin=!1,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSignUp:function(e){return(e=e||{}).step="signup",e.async="false",e.isRegistered=!0,_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userSubscribe:function(e){return(e=e||{}).step="subscribe",e.async="false",_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userUnsubscribe:function(e){return(e=e||{}).step="unsubscribe",e.async="false",_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userInfoUpdate:function(e){(e=e||{}).step="update",e.async="false",void 0!==e.isLogin&&(e.isRegistered="true"===e.isLogin||!0===e.isLogin?"true":e.isRegistered);var t=JSON.stringify(e),n=_SgmntfY_._getPersistentData("sgfUserUpdateData",!0);if(void 0===n||t!==n)return _SgmntfY_._storePersistentData("sgfUserUpdateData",t,-1,!0),_SgmntfY_._prepareRequest(e,"USER_OPERATIONS")},userForm:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"FORM")},customEvent:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"CUSTOM_EVENT")},search:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"SEARCH")},interaction:function(e){return(e=e||{}).async="false",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),"impression"!==e.type&&"widget-view"!==e.type&&"push-permission-impression"!==e.type&&"push"!==e.type&&"email"!==e.type||(e.nextPage=!1),_SgmntfY_._prepareRequest(e,"INTERACTION")},bannerImpression:function(e){return(e=e||{}).async="false",e.type="impression",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerClick:function(e){return(e=e||{}).async="false",e.type="click",_SgmntfY_._variables.disableNextPage||void 0!==e.nextPage||(e.nextPage=!0),_SgmntfY_._addClickedBanner(e.title,e.group,e.order,e.url),_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerUpdate:function(e){return(e=e||{}).async="false",e.type="update",_SgmntfY_._prepareRequest(e,"BANNER_OPERATIONS")},bannerGroupView:function(e){return e=e||{},_SgmntfY_._prepareRequest(e,"BANNER_GROUP_VIEW")},bannerGroupDetail:function(e){return(e=e||{}).async="false",_SgmntfY_._prepareRequest(e,"INTERNAL_BANNER_GROUP")},promotionImpression:function(e){return(e=e||{}).type="impression","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},promotionView:function(e){return(e=e||{}).type="view","string"==typeof e.categories&&(e.categories=[e.categories]),e.categories=(e.categories||[]).filter(_SgmntfY_._null),"string"==typeof e.brands&&(e.brands=[e.brands]),e.brands=(e.brands||[]).filter(_SgmntfY_._null),"string"==typeof e.labels&&(e.labels=[e.labels]),e.labels=(e.labels||[]).filter(_SgmntfY_._null),"string"==typeof e.productIds&&(e.productIds=[e.productIds]),e.productIds=(e.productIds||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"PROMOTION")},pushInteraction:function(e){return(e=e||{}).async="false",e.nextPage="false",_SgmntfY_._storePersistentData(e.instanceId,"1",.006),_SgmntfY_.LOG_MESSAGE("DEBUG","Push campaign interaction is sent for campaign: "+e.instanceId),_SgmntfY_._prepareRequest(e,"INTERACTION")},filter:function(e){return(e=e||{}).categories=(e.categories||[]).filter(_SgmntfY_._null),e.brands=(e.brands||[]).filter(_SgmntfY_._null),e.sizes=(e.sizes||[]).filter(_SgmntfY_._null),e.prices=(e.prices||[]).filter(_SgmntfY_._null),_SgmntfY_._prepareRequest(e,"FILTER")},coupon:function(e){return(e=e||{}).nextPage="false",_SgmntfY_._prepareRequest(e,"COUPON")}},_prepareRequest:function(e,t,n){if(void 0===e.noSend||"true"!==e.noSend)if(_SgmntfY_._getJq()("html").hasClass("translated-ltr")||_SgmntfY_._getJq()("html").hasClass("translated-rtl"))_SgmntfY_.LOG_MESSAGE("DEBUG","Page is translated, ignoring event");else if(navigator&&navigator.language&&"c"===navigator.language)_SgmntfY_.LOG_MESSAGE("DEBUG","This is a bot, ignoring event");else if(_SgmntfY_._isEmpty(_SgmntfY_._variables.apiKey))_SgmntfY_.LOG_MESSAGE("ERROR","Api Key is not set, not sending event: "+t);else if(_SgmntfY_._isEmpty(_SgmntfY_._getUserId()))_SgmntfY_.LOG_MESSAGE("ERROR","userId is not set, not sending event: "+t);else{if(!_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())){if(void 0===n&&(n=!1),!n&&"boolean"==typeof e.nextPage&&!0===e.nextPage)return _SgmntfY_._addToNextPageQueue({eventName:t,params:e}),null;var a=new Date,r={data:{name:t,userId:_SgmntfY_._getUserId(),sessionId:_SgmntfY_._getSessionId(),testMode:_SgmntfY_._getTestMode()||"false",device:_SgmntfY_._variables.ua.type||"PC",noProcess:e.noProcess||!1,tryCount:0,nextPage:e.nextPage||!1,params:e.params||{},recommendIds:(e.recommendIds||[]).filter(_SgmntfY_._null),pageUrl:e.pageUrl||document.URL,referrer:e.referrer||document.referrer,browser:e.browser||_SgmntfY_._variables.ua.name,os:e.os||_SgmntfY_._variables.ua.os,osversion:e.osversion||_SgmntfY_._variables.ua.osversion,userAgent:e.userAgent||_SgmntfY_._variables.ua.agentString,lang:e.lang||_SgmntfY_._variables.language,currency:e.currency||_SgmntfY_._variables.currency,region:e.region||_SgmntfY_._variables.region,async:e.async||"true",email:e.email||"",ft:_SgmntfY_._getFireTime(a)||"",tz:_SgmntfY_._getTimeZone(a)||""},originalParams:e,eventName:t};"function"==typeof e.recommendationCallback&&_SgmntfY_._getJq().extend(r,{recommendationCallback:e.recommendationCallback});for(var i=_SgmntfY_._variables.requiredParams[t],s=0;s<i.length;++s){if(!_SgmntfY_._isNotEmpty(e[i[s]]))return void _SgmntfY_.LOG_MESSAGE("ERROR","Missing parameter["+i[s]+"] in event: "+t);r.data[i[s]]=e[i[s]],"string"==typeof r.data[i[s]]&&(r.data[i[s]]=_SgmntfY_._clearNullByte(r.data[i[s]]).trim())}var o=_SgmntfY_._variables.optionalParams[t];for(s=0;s<o.length;++s)_SgmntfY_._isNotEmpty(e[o[s]])&&(r.data[o[s]]=e[o[s]],"string"==typeof r.data[o[s]]&&(r.data[o[s]]=_SgmntfY_._clearNullByte(r.data[o[s]]).trim()));return r}_SgmntfY_.LOG_MESSAGE("ERROR","sessionId is not set, not sending event: "+t)}else _SgmntfY_.LOG_MESSAGE("DEBUG","No send flag is set for event: "+t+", ignoring event")},_storePersistentData:function(e,t,n,a){if("undefined"!=typeof Storage&&a)try{localStorage.setItem(e,t),_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Local Storage) Update: "+e+": "+t)}catch(n){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Local Storage) Update: "+e+": "+t)}else{"string"==typeof t&&(t=encodeURIComponent(t));var r,i,s="",o="";n&&((r=new Date).setTime(r.getTime()+24*n*60*60*1e3),s="; expires="+r.toGMTString()),_SgmntfY_._variables.domain&&_SgmntfY_._variables.domain.split(".").length>=2&&(o="; domain="+_SgmntfY_._variables.domain),i=e+"="+t+s+o+"; path=/";try{document.cookie=i,_SgmntfY_.LOG_MESSAGE("DEBUG","Segmentify Persistent Data (Cookie) Update: "+i)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't store Persistent Data (Cookie) Update: "+i)}}},_getPersistentData:function(e,t){if("undefined"!=typeof Storage&&t)try{return localStorage.getItem(e)}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Local Storage): "+e),null}else{var n=e+"=";try{for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var i=a[r].trim();if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null}catch(t){return _SgmntfY_.LOG_MESSAGE("ERROR","Can't get Persistent Data (Cookie): "+e),null}}},_clearProductUrl:function(e){return _SgmntfY_._stripQueryParameters(e,["_sgm_source","_sgm_campaign","_sgm_action","_sgm_type","_sgm_test","utm_source","utm_medium","utm_term","utm_content","utm_campaign","utm_type","p_id","gclid","ds_p","ds_eid","ds_aid","ds_e","ds_c","ds_cid","ds_ag","ds_agid","ds_k","ds_kid","ds_kids","ds_kidnl","gclick","gsrc","gclsrc"])},_stripQueryParameters:function(e,t){if(void 0===t||!t)return e;"string"==typeof t&&(t=[t]);var n=(e||"").split("?");if(n.length>=2){for(var a=[],r=0;r<(t||[]).length;r++)a.push(encodeURIComponent(t[r])+"=");var i=n[1].split(/[&;]/g);for(r=i.length;r-- >0;)for(var s=0;s<a.length;s++)if(-1!==i[r].lastIndexOf(a[s],0)){i.splice(r,1);break}return i.length>0?n[0]+"?"+i.join("&"):n[0]}return e},_getQueryParameter:function(e,t){var n=location.search;void 0!==t&&(n=t),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#?]*)").exec(n);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},_sendTrackedEvent:function(e){var t,n,a,r,i=_SgmntfY_._getQueryParameter("_sgm_push_redirect_url",e);if(i&&0!==i.length&&(window.location=i),"segmentify"===_SgmntfY_._getQueryParameter("utm_source",e)?(t=_SgmntfY_._getQueryParameter("utm_campaign",e),n=_SgmntfY_._getQueryParameter("utm_medium",e),a=_SgmntfY_._getQueryParameter("utm_content",e),r=_SgmntfY_._getQueryParameter("_sgm_coupon",e)):(t=_SgmntfY_._getQueryParameter("_sgm_campaign",e),n=_SgmntfY_._getQueryParameter("_sgm_action",e),a=_SgmntfY_._getQueryParameter("_sgm_source",e),r=_SgmntfY_._getQueryParameter("_sgm_coupon",e)),"push"===n){var s=_SgmntfY_._getPersistentData(t);(_SgmntfY_._isEmpty(s)||_SgmntfY_._isNotEmpty(s)&&"0"===s)&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a+" - type: push-click"),_SgmntfY_._variables.segmentifyObj("push:click:interaction",{type:"push-click",interactionId:a,instanceId:t}))}t&&n&&a&&(_SgmntfY_.LOG_MESSAGE("DEBUG","Sending tracked event: "+n+" - "+t+" - "+a),_SgmntfY_._variables.segmentifyObj("event:interaction",{type:n,interactionId:a,instanceId:t}),"push"===n&&r&&_SgmntfY_._variables.segmentifyObj("coupon",{type:n,interactionId:a,instanceId:t}))},_setTestMode:function(e){var t=e||_SgmntfY_._getQueryParameter("_sgm_test");if(_SgmntfY_._toggleTestMode(t),"exists"!==_SgmntfY_._getExtensionStatus()&&"true"===_SgmntfY_._getTestMode())try{var n=['<div class="sgm-test-mode-header">','<a href="http://www.segmentify.com" target="_blank" class="sgm-logo"> </a>','<a href="https://chrome.google.com/webstore/detail/segmentify/dhcffckfimabfhbbjdngnajhnlohfjeo" target="_blank" class="sgm-ext"><span>Get <strong>Chrome Extension</strong> Now!</span></a>','<span class="sgm-test-mode-Show-Hide" data-hide="Hide" data-show="Show"></span>','<div class="sgm-test-mode-key">','<h2 id="sgm-test-mode-message"> Your browser is in<strong>Segmentify Test Mode</strong> </h2>','<div class="sgm-test-mode-radio">','<input class="sgm-tgl sgm-tgl-ios" id="sgm-cb1" type="checkbox" checked>','<label class="sgm-tgl-btn" for="sgm-cb1"></label>',"</div>","</div>","</div>"].join("\n");setTimeout(function(){_SgmntfY_._getJq()("body").prepend(n),"chrome"!==_SgmntfY_._variables.ua.name.toLowerCase()&&_SgmntfY_._getJq()(".sgm-test-mode-header .sgm-ext").hide(),_SgmntfY_._getJq()("body").addClass("sgm-test-body"),_SgmntfY_._getJq()("#sgm-cb1").change(function(){var e=_SgmntfY_._getJq()(this);setTimeout(function(){_SgmntfY_._toggleTestMode(e.is(":checked")?"on":"off")},400)}),_SgmntfY_._getJq()(".sgm-test-mode-Show-Hide").click(function(){_SgmntfY_._getJq()("body").toggleClass("sgm-test-header-open")})},800)}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't show test mode header: "+e)}},_getTestMode:function(){return _SgmntfY_._getPersistentData(_SgmntfY_._variables.testMode)},_toggleTestMode:function(e){"on"===e?(_SgmntfY_._getJq()("#sgm-test-mode-message").html("Your browser is in<strong>Segmentify Test Mode</strong>"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#50BC61"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode activated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"true",180)):"off"===e&&(_SgmntfY_._getJq()("#sgm-test-mode-message").html("<strong>Segmentify Test Mode</strong> is disabled"),_SgmntfY_._getJq()("#sgm-test-mode-message").find("strong").css("color","#fff"),_SgmntfY_.LOG_MESSAGE("INFO","Segmentify Test Mode deactivated"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.testMode,"false",180),window.alert("You are out of Segmentify Test Mode, you will not see test campaigns."),window.location=_SgmntfY_._stripQueryParameters(document.URL,"_sgm_test"))},_getTracking:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.tracking);return _SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),e},_setTracking:function(e){"disabled"!==e&&(e="enabled"),_SgmntfY_._storePersistentData(_SgmntfY_._variables.tracking,e,390)},_getSessionId:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.sessionStorageKey,_SgmntfY_._variables.storage.session.local);return e?e.trim():""},_getUserId:function(){var e=_SgmntfY_._getPersistentData(_SgmntfY_._variables.userStorageKey,_SgmntfY_._variables.storage.user.local);return e?e.trim():""},_shuffle:function(e){for(var t,n,a=e.length;a;t=Math.floor(Math.random()*a),n=e[--a],e[a]=e[t],e[t]=n);return e},_getClickedBanners:function(){try{var e=_SgmntfY_._variables.storage.clickedBanners;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read clicked banners: "+e)}return[]},_addClickedBanner:function(e,t,n,a){if(void 0!==e&&void 0!==t&&void 0!==n&&void 0!==a){var r=e+":"+t+":"+n+":"+a,i=_SgmntfY_._getClickedBanners();-1===i.indexOf(r)&&i.push(r),i.length>_SgmntfY_._variables.constants.clickedBannersLimit&&(i=i.splice(i.length-_SgmntfY_._variables.constants.clickedBannersLimit));var s=_SgmntfY_._variables.storage.clickedBanners;_SgmntfY_._storePersistentData(s.key,JSON.stringify(i),0,s.local)}},_getDelayedActions:function(){try{var e=_SgmntfY_._variables.storage.delayedActions;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed actions: "+e)}return[]},_setDelayedActions:function(e){var t=_SgmntfY_._variables.storage.delayedActions;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e.params.actionId)return!1;var a=new Date;if(e.delayDate.getTime()<a.getTime())return!1;var r=e.type,i=_SgmntfY_._actions[e.type],s=e.params,o=e.request;return setTimeout(function(){for(var t=_SgmntfY_._getDelayedActions(),n=!1,a=0;a<t.length;a++)t[a].params.actionId===e.params.actionId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") is triggered after delay"),i.call(null,s,o),_SgmntfY_._removeDelayedAction(s.actionId))},e.delayDate.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedActions(t),!0},_removeDelayedAction:function(e){for(var t=_SgmntfY_._getDelayedActions(),n=0;n<t.length;n++)if(t[n].params.actionId===e)return t.splice(n,1),void _SgmntfY_._setDelayedActions(t)},_getRetryQueue:function(){try{var e=_SgmntfY_._variables.storage.retryQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read retry queue: "+e)}return[]},_setRetryQueue:function(e){var t=_SgmntfY_._variables.storage.retryQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToRetryQueue:function(e){for(var t=_SgmntfY_._getRetryQueue();e.length>0;){var n=e.shift();if("CHECKOUT"===n.eventName||"BASKET_OPERATIONS"===n.eventName||"INTERACTION"===n.eventName){var a=n.data.tryCount||0;a<_SgmntfY_._variables.constants.retryLimit&&(n.data.tryCount=a+1,_SgmntfY_._variables.isUnload&&(n.originalParams.discardResponse="true"),t.push(n))}}_SgmntfY_._setRetryQueue(t)},_consumeRetryQueue:function(){var e=_SgmntfY_._getRetryQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setRetryQueue([])}},_getDataLayer:function(){return window[_SgmntfY_._variables.dataLayer]},_consumeDataLayer:function(){if(_SgmntfY_._variables.consumeDataLayer){var e=[],t=function(t,n){if(!n.hasOwnProperty("__processed__")||!0!==n.__processed__){var a=_SgmntfY_._extend(n,r),i=_SgmntfY_._functions.getDataLayerFunction(t,a).apply(null,[a]);i&&e.push(i)}},n=function(e,t){var n=JSON.parse(JSON.stringify(t)),a=_SgmntfY_._variables.dataLayerConfig[e]||{};for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(n.hasOwnProperty(i)){var s=n[i];delete n[i],n[r]=s}}return n},a=_SgmntfY_._getDataLayer()||{},r=n("common",a.common||{});for(var i in r.hasOwnProperty("userId")&&_SgmntfY_._functions.setUserId(r.userId),a)if(a.hasOwnProperty(i)){if("common"===i)continue;if(_SgmntfY_._getJq().isArray(a[i]))for(var s=0;s<a[i].length;++s)t(i,n(i,a[i][s])),_SgmntfY_._getDataLayer()[i][s].__processed__=!0;else t(i,n(i,a[i])),_SgmntfY_._getDataLayer()[i].__processed__=!0}e.length>0&&_SgmntfY_._sendRequestToServer(e)}},_getNextPageQueue:function(){try{var e=_SgmntfY_._variables.storage.nextPageQueue;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read next page queue: "+e)}return[]},_setNextPageQueue:function(e){var t=_SgmntfY_._variables.storage.nextPageQueue;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addToNextPageQueue:function(e){var t=_SgmntfY_._getNextPageQueue();t.push(e),_SgmntfY_._setNextPageQueue(t)},_consumeNextPageQueue:function(){var e=_SgmntfY_._getNextPageQueue();if(e&&e.length>0){for(var t=[];e.length>0;){var n=e.shift();n.hasOwnProperty("data")||(n=_SgmntfY_._prepareRequest(n.params,n.eventName,!0)),n.data.userId=_SgmntfY_._getUserId(),n.data.sessionId=_SgmntfY_._getSessionId(),t.push(n)}_SgmntfY_._sendRequestToServer(t),_SgmntfY_._setNextPageQueue([])}},_addRecommendedProduct:function(e){_SgmntfY_._variables.recommendedProducts.push(e)},_containsRecommendedProduct:function(e){return _SgmntfY_._variables.recommendedProducts.indexOf(e)>=0},_addRecommendedPromotion:function(e){_SgmntfY_._variables.recommendedPromotions.push(e)},_containsRecommendedPromotion:function(e){return _SgmntfY_._variables.recommendedPromotions.indexOf(e)>=0},_getExtensionStatus:function(){try{var e=_SgmntfY_._variables.storage.extensionStatus;return _SgmntfY_._getPersistentData(e.key,e.local)||""}catch(e){_SgmntfY_.LOG_MESSAGE("DEBUG","Can't read extension status: "+e)}return""},_getDelayedCampaigns:function(){try{var e=_SgmntfY_._variables.storage.delayedCampaigns;return JSON.parse(_SgmntfY_._getPersistentData(e.key,e.local))||[]}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't read delayed campaigns: "+e)}return[]},_setDelayedCampaigns:function(e){var t=_SgmntfY_._variables.storage.delayedCampaigns;_SgmntfY_._storePersistentData(t.key,JSON.stringify(e),0,t.local)},_addDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;++n)if(t[n].campaign.instanceId===e.campaign.instanceId)return!1;var a=new Date;if(e.time.getTime()<a.getTime())return!1;var r=e.campaign,i=e.request,s=_SgmntfY_._campaigns[r.type];return setTimeout(function(){for(var t=_SgmntfY_._getDelayedCampaigns(),n=!1,a=0;a<t.length;++a)t[a].campaign.instanceId===e.campaign.instanceId&&(n=!0);n&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r.type+") triggered after delay"),s.call(null,r,i),_SgmntfY_._removeDelayedCampaign(r.instanceId))},e.time.getTime()-a.getTime()+Math.floor(750*Math.random())),t.push(e),_SgmntfY_._setDelayedCampaigns(t),!0},_removeDelayedCampaign:function(e){for(var t=_SgmntfY_._getDelayedCampaigns(),n=0;n<t.length;n++)if(t[n].campaign.instanceId===e)return t.splice(n,1),void _SgmntfY_._setDelayedCampaigns(t)},_getFireTime:function(e){function t(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n}try{return e.getFullYear()+"."+t(e.getMonth()+1,2)+"."+t(e.getDate(),2)+" "+t(e.getHours(),2)+":"+t(e.getMinutes(),2)+":"+t(e.getSeconds(),2)+"."+t(e.getMilliseconds(),3)}catch(e){return""}},_getTimeZone:function(e){try{return e.getTimezoneOffset().toString()}catch(e){return""}},_getJq:function(){return _SgmntfY_._variables.jq},_getMustache:function(){return _SgmntfY_._variables.mustache},_getObjectByString:function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),a=0,r=n.length;a<r;++a){var i=n[a];if(!(i in e))return;e=e[i]}return e},_isUndefined:function(e){return void 0===e},_notNull:function(e){return void 0!==e&&null!=e},_isEmpty:function(e){return void 0===e||null==e||""===e},_isNotEmpty:function(e){return!_SgmntfY_._isEmpty(e)},_isPlainObject:function(e){if("object"==typeof e&&null!==e){if("function"==typeof Object.getPrototypeOf){var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t}return"[object Object]"==Object.prototype.toString.call(e)}return!1},_exists:function(e){return e instanceof HTMLElement?null!==e:(e instanceof HTMLCollection||e instanceof _SgmntfY_._getJq()||e instanceof jQuery||e instanceof $)&&e.length>0},_extend:function(){var e,t,n,a,r,i=arguments[0]||{},s=1,o=arguments.length,_=!1;for("boolean"==typeof i&&(_=i,i=arguments[s]||{},s++);s<o;s++)if(null!=(e=arguments[s]))for(t in e)if(e.hasOwnProperty(t)){if(n=i[t],i===(a=e[t]))continue;_&&a&&_SgmntfY_._isPlainObject(a)?(r=n&&"object"==typeof n&&null!==n?n:{},i[t]=_SgmntfY_._extend(_,r,a)):void 0!==a&&(i[t]=a)}return i},_split:function(e,t,n){if(e&&"string"==typeof e){var a,r=e.split(t);for(a=0;a<r.length;a++)r[a]=r[a].trim();if(n&&n<r.length){var i=r.splice(0,n-1);i.push(r.join(t)),r=i}return r}return null},_parseFloat:function(e){return null==e?e:void 0===e?null:"number"==typeof e?e:"string"==typeof e?parseFloat(e):e},_parseBoolean:function(e){return void 0===e?null:"number"==typeof e?0===e?"false":"true":"string"==typeof e?"0"===e||"false"===e.toLowerCase()?"false":"true":"boolean"==typeof e?e.toString():e},_null:function(e){return null!=e&&""!=e},_clearNullByte:function(e){return e.replace(/\0/g,"")},_checkVersion:function(e,t){var n=t.split("."),a=e.split(".");prevs=[];for(var r=0,i=Math.max(n.length,a.length);r<i;r++){if(n[r]=parseInt(n[r]),isNaN(n[r])&&(n[r]=0),a[r]=parseInt(a[r]),isNaN(a[r])&&(a[r]=0),n[r]<a[r])return!1;if(n[r]>a[r])return!0}return!0},_updateBrowserAndDeviceInfo:function(){if(void 0!==window.bowser){var e=window.bowser._detect(_SgmntfY_._variables.ua.agentString);null==_SgmntfY_._variables.ua.type&&(e.tablet?_SgmntfY_._variables.ua.type="tablet":e.mobile?_SgmntfY_._variables.ua.type="mobile":_SgmntfY_._variables.ua.type="PC",e.chromium?_SgmntfY_._variables.ua.name="Chrome":_SgmntfY_._variables.ua.name=e.name,_SgmntfY_._variables.ua.version=e.version),null==_SgmntfY_._variables.ua.os&&(_SgmntfY_._variables.ua.os=e.osname||"Other",_SgmntfY_._variables.ua.osversion=e.osversion)}},_addLeavePageHandler:function(e,t){var n=e.type,a=e.params,r=_SgmntfY_._actions[n];_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered when user leaves page");var i=function(e){e.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",i),r.call(null,a,t))};_SgmntfY_._getJq()(document).bind("mouseleave",i)},_addWaitPageHandler:function(e,t){var n=e.type,a=e.params,r=e.delayAction||null,i=_SgmntfY_._actions[n],s=parseInt(r.time);_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") will be triggered after "+s+" second(s) delay on same page"),setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Action("+n+") is triggered after delay"),i.call(null,a,t)},1e3*s)},_addScrollHandler:function(e,t){var n=e.type,a=e.delayAction,r=parseInt(a.time)||0;_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Action ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._actions[n].call(null,e.params,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignDelayHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+" second(s) delay on same page"),window.setTimeout(function(){_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+" delay"),_SgmntfY_._campaigns[n].call(null,e,t)},1e3*r)},_addCampaignDelayAllPagesHandler:function(e,t){var n=e.timing||"0",a={campaign:e,request:t,time:new Date((new Date).getTime()+1e3*parseInt(n.param))};_SgmntfY_._addDelayedCampaign(a)?_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") added for delayed campaign in future"):_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+e.instanceId+") already added for delayed campaign")},_addCampaignScrollHandler:function(e,t){var n=e.type,a=e.timing,r=parseInt(a.param);_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered after "+r+"% of page is scrolled");var i=function(){r<=_SgmntfY_._getScrollPercent()&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered after "+r+"% of page is scrolled"),_SgmntfY_._getJq()(document).unbind("scroll",i),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("scroll",i)},_addCampaignLeaveHandler:function(e,t){var n=e.type;_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") will be triggered when user leaves page");var a=function(r){r.clientY<0&&(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+n+") triggered at user leave page"),_SgmntfY_._getJq()(document).unbind("mouseleave",a),_SgmntfY_._campaigns[n].call(null,e,t))};_SgmntfY_._getJq()(document).bind("mouseleave",a)},_addCampaignInteractionHandler:function(e,t){},_getScrollPercent:function(){var e=document.documentElement,t=document.body,n="scrollTop",a="scrollHeight";return(e[n]||t[n])/((e[a]||t[a])-e.clientHeight)*100},_updateUserAndSessionId:function(e){_SgmntfY_._variables.waitingKeys=!0;var t={data:null,url:_SgmntfY_._variables.segmentifyApiUrl+"/get/key/v1.json?count="+e};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"GET",url:t.url,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a),2===e&&_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,n[1],390,_SgmntfY_._variables.storage.user.local);var i=_SgmntfY_._getUserId();_SgmntfY_._isEmpty(i)?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Id"):(_SgmntfY_.LOG_MESSAGE("INFO","User Id Changed: "+i),_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,n[0],0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._isEmpty(_SgmntfY_._getSessionId())?_SgmntfY_.LOG_MESSAGE("ERROR","Can't update User Session"):(_SgmntfY_.LOG_MESSAGE("INFO","User Session Changed: "+n[0]),_SgmntfY_._variables.waitingKeys=!1,_SgmntfY_._variables.keysTryCount++))}).fail(function(e,n,a){_SgmntfY_._ajaxError(t,e,n,a),_SgmntfY_._variables.keysTryCount++,_SgmntfY_._variables.waitingKeys=!1})},_sendRequestToServer:function(e){if(e&&!(e.length<=0)){for(var t=[],n=0;n<e.length;n++)t.push(e[n].data);var a={"X-Sfy-Api-Key":_SgmntfY_._variables.apiKey};_SgmntfY_._getJq().ajax({contentType:"text/plain",processData:!1,type:"POST",url:_SgmntfY_._variables.segmentifyApiUrl+"/add/events/v1.json?apiKey="+_SgmntfY_._variables.apiKey,data:JSON.stringify(t),headers:a,timeout:1e3*_SgmntfY_._variables.constants.eventTimeout}).done(function(n,a,r){_SgmntfY_._ajaxSuccess(t,n,a);var i=n.statusCode||"";if("SUCCESS"===i){var s=n.responses,o=n.campaigns,_=n.search,c=n.coupons||[[]];if(s.length===e.length&&o.length===e.length)for(var m=0;m<s.length;m++){var g=e[m],d=s[m],l=o[m],f=_[m],u=c[m];"true"!==g.originalParams.discardResponse?(_SgmntfY_._getResponse(g,d),_SgmntfY_._getCampaign(g,l),_SgmntfY_._getSearchCampaign(g,f),_SgmntfY_.initCoupon(u)):_SgmntfY_.LOG_MESSAGE("DEBUG","Action("+g.eventName+") responses are discarded")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response length("+s.length+") doesn't match request length("+e.length+")")}else _SgmntfY_.LOG_MESSAGE("WARN","Segmentify response is ("+i+")"),"NO_SESSIONID"===i?_SgmntfY_._updateUserAndSessionId(1):"NO_USERID"===i&&_SgmntfY_._updateUserAndSessionId(2)}).fail(function(n,a,r){0!==_SgmntfY_._getJq()(".seg-search-wrapper").length&&(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?_SgmntfY_._getJq().each(_SgmntfY_._getJq()(_SgmntfY_._variables.search.input),function(){"matrix(1, 0, 0, 1, 0, -2000)"==_SgmntfY_._getJq()(this).css("transform")&&(_SgmntfY_._getJq()(this).addClass("seg-search-unset"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),_SgmntfY_._getJq()(this).blur())}):(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("open")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-open"))&&(_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"))),_SgmntfY_._addToRetryQueue(e),_SgmntfY_._ajaxError(t,n,a,r)})}},_getResponse:function(e,t){for(var n=0;n<t.length;n++){var a=t[n];if(a.hasOwnProperty("type")){var r=a.type,i=a.delayAction||null,s=a.params,o=(a.instanceId,_SgmntfY_._actions[r]);if(!1===s.isControlGroup){_SgmntfY_.LOG_MESSAGE("DEBUG","User is in control group for campaign: "+s.instanceId);continue}if("function"==typeof o)if(i&&"LEAVE_PAGE"===i.type)_SgmntfY_._addLeavePageHandler(a,e);else if(i&&"WAIT_SAME_PAGE"===i.type&&parseInt(i.time)>0)_SgmntfY_._addWaitPageHandler(a,e);else if(i&&"WAIT_ALL_PAGES"===i.type&&parseInt(i.time)>0){var _={delayDate:new Date((new Date).getTime()+1e3*parseInt(i.time)),params:s,type:r,request:e};_SgmntfY_._addDelayedAction(_)?_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+_.params.actionId+") is added for delayed action in future"):_SgmntfY_.LOG_MESSAGE("INFO","Action(id="+_.params.actionId+") is already added for delayed action")}else i&&"SCROLL"===i.type?_SgmntfY_._addScrollHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Action("+r+") triggered immediately"),o.call(null,s,e));else _SgmntfY_.LOG_MESSAGE("WARN","Unknown action: "+r)}}},_getSearchCampaign:function(e,t){if(0!==t.length){var n=t[0].isExecutable;if(void 0!==n&&!0===n){var a=t[0].idOrClassName,r=t[0].manuelTrigger;_SgmntfY_._variables.search.input=a,_SgmntfY_._initSearch(a,r)}else void 0!==e.data.query&&"undefined"!=typeof sgmLastFocusedInput&&e.data.query!==_SgmntfY_._getJq()(sgmLastFocusedInput).val()||_SgmntfY_._getSearch(e,t)}},_getCampaign:function(e,t){for(var n=0;n<t.length;n++){var a=t[n]||{};if(a.hasOwnProperty("type")){var r=a.type,i=_SgmntfY_._campaigns[r];if("function"==typeof i){var s=a.timing||{};"DELAY"===s.type?_SgmntfY_._addCampaignDelayHandler(a,e):"DELAY_ALL_PAGES"===s.type?_SgmntfY_._addCampaignDelayAllPagesHandler(a,e):"SCROLL"===s.type?_SgmntfY_._addCampaignScrollHandler(a,e):"PAGELEAVE"===s.type?_SgmntfY_._addCampaignLeaveHandler(a,e):"INTERACTION"===s.type?_SgmntfY_._addCampaignInteractionHandler(a,e):(_SgmntfY_.LOG_MESSAGE("INFO","Campaign ("+r+") triggered immediately."),i.call(null,a,e))}else _SgmntfY_.LOG_MESSAGE("WARN","Unknown campaign: "+r)}}},mobileSearchCancel:function(){var e=document.querySelector(".seg-search-wrapper");return bodyScrollLock.enableBodyScroll(e),_SgmntfY_._getJq()("body, .wrapper-1").removeClass("noscroll"),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),_SgmntfY_._getJq()(_SgmntfY_._variables.search.input).val(""),manuelTriggerClicked=!1,!1},initCoupon:function(e){try{if(0===e.length)return;var t=_SgmntfY_._getJq()(document).find("#seg-coupon-asimov");if(t&&t.length>0)return;var n=e[0],a=n.widget.html,r=n.widget.validationText,i={code:n.code,valid_until:r+" "+new Date(n.validUntil).toLocaleDateString(),copy_button_text:n.widget.copyButtonText,description:n.widget.description,title:n.widget.title},s=_SgmntfY_._getMustache().render(a,i),o=(s=_SgmntfY_._getJq()(s)).first(),_=s.find(".seg-coupon-asimov_content"),c=s.find(".seg-coupon-asimov_switch");"RIGHT"===n.widget.position&&o.addClass("seg-coupon-asimov_right"),_.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),c.css({"background-color":n.widget.backgroundColor,color:n.widget.foregroundColor}),_SgmntfY_._getJq()("body").prepend(s),_SgmntfY_.bindCouponBindings({copiedInfoText:n.widget.copiedInfoText}),_SgmntfY_._openCoupon(),setTimeout(function(){_SgmntfY_._closeCoupon()},2e3)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Coupon couldn't be rendered!")}},bindCouponBindings:function(e){try{function t(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}else setTimeout(function(){e.css("height","auto")},500);setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")}_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_switch",function(){if(_SgmntfY_._getJq()(this).parent("#seg-coupon-asimov").hasClass("no-interaction"))return!1;t()}),_SgmntfY_._getJq()(document).on("click",".seg-coupon-asimov_copy:not(.no-interaction)",function(){_SgmntfY_._getJq()("#seg-coupon-asimov").addClass("no-interaction"),_SgmntfY_._getJq()(this).addClass("no-interaction"),function(e){if(e=document.getElementsByClassName(e)[0],document.body.createTextRange){var t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){var n=window.getSelection(),t=document.createRange();t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}else _SgmntfY_.LOG_MESSAGE("WARN","Could not select text in node: Unsupported browser.");document.execCommand("copy"),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}("seg-coupon-asimov_code");var n=_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html();return _SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(e.copiedInfoText),setTimeout(function(){t(),setTimeout(function(){_SgmntfY_._getJq()(".seg-coupon-asimov_copy").html(n),_SgmntfY_._getJq()("#seg-coupon-asimov").removeClass("no-interaction"),_SgmntfY_._getJq()(".seg-coupon-asimov_copy").removeClass("no-interaction")},400)},1e3),!1})}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Could not bind coupon bindings.")}},_openCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),setTimeout(function(){e.css("height","auto")},500),setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_closeCoupon:function(){var e=_SgmntfY_._getJq()("#seg-coupon-asimov");if(e.addClass("no-interaction"),e.css("height",_SgmntfY_._getJq()("#seg-coupon-asimov").prop("scrollHeight")),e.hasClass("seg-coupon-asimov_open")){var t=e.children(".seg-coupon-asimov_switch").height();e.css("height",t)}setTimeout(function(){e.removeClass("no-interaction")},500),e.toggleClass("seg-coupon-asimov_open")},_getSearch:function(request,search){var searchArray=search[0],campaign=searchArray.campaign,products=searchArray.products||{},brands=searchArray.brands||{},brandProducts=searchArray.brandProducts||{},categories=searchArray.categories||{},categoryProducts=searchArray.categoryProducts||{},keywords=searchArray.keywords||{};if(null!=campaign){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"impression",interactionId:"static",instanceId:campaign.instanceId}),null!==products&&products.length>0&&_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"widget-view",interactionId:"static",instanceId:campaign.instanceId}),sgmSearchSettings={data:{},mobileInput:"#sgm-mobile-input",searchResultsEl:".seg-search-wrapper",incremental:searchArray.incremental,searchUrlPrefix:campaign.searchUrlPrefix,html:campaign.html,postJs:campaign.postJs,preJs:campaign.preJs,css:campaign.css,openingDirection:campaign.openingDirection,input:campaign.searchInputSelector,currentSearchBoxEl:campaign.hideCurrentSelector,searchAssets:campaign.searchAssets||[],mobileSearchAssets:campaign.mobileSearchAssets||[],searchAssetsTexts:campaign.stringSearchAssetTextMap||[],categoryTreeView:!1,manuelTrigger:campaign.triggerSelector,sgmSearchShowAll:!1,resultsTopMargin:{mobile:0,desktop:0},isSidebarItemsClickable:{categories:!1,brands:!1,keywords:!1},highlightEnabled:{categories:!1,brands:!1,keywords:!1},itemLimits:{howManyBrand:0,howManyCategory:0,howManyKeyword:0,howManyDesktopProduct:campaign.desktopItemCount,howManyMobileProduct:campaign.mobileItemCount},itemEnable:{category:!1,brand:!1,keyword:!1},sidebar:{mobile:!1,desktop:!0},texts:{categories:"",popularCategories:"",brands:"",popularBrands:"",keywords:"",products:"",popularProducts:campaign.popularProductsText,showAll:"Show All",currency:"",notFound:"",cancelText:""}},_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth&&0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")),0==_SgmntfY_._getJq()("#sgm_current_search_box").length&&_SgmntfY_._getJq()("head").append('<style id="sgm_current_search_box">'+sgmSearchSettings.currentSearchBoxEl+" { display: none!important; position: absolute!important; left: -999999px!important; top: -99999999px!important; visibility: hidden!important; opacity: 0!important }</style>"),_SgmntfY_._variables.search.searchDelay=campaign.searchDelay,_SgmntfY_._variables.search.searchMinChar=campaign.minCharacterCount,sgmSearchSettings.texts.showAll=_SgmntfY_._variables.search.showAll;var searchAssetsElems=_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?sgmSearchSettings.mobileSearchAssets:sgmSearchSettings.searchAssets;_SgmntfY_._getJq().each(searchAssetsElems,function(e,t){"CATEGORY"===t.type?(sgmSearchSettings.categoryTreeView=t.categoryTreeView,sgmSearchSettings.isSidebarItemsClickable.categories=t.clickable,sgmSearchSettings.itemLimits.howManyCategory=t.itemCount,sgmSearchSettings.itemEnable.category=!0,sgmSearchSettings.highlightEnabled.categories=t.highlight):"BRAND"===t.type?(sgmSearchSettings.isSidebarItemsClickable.brands=t.clickable,sgmSearchSettings.itemLimits.howManyBrand=t.itemCount,sgmSearchSettings.itemEnable.brand=!0,sgmSearchSettings.highlightEnabled.brands=t.highlight):"KEYWORD"===t.type&&(sgmSearchSettings.isSidebarItemsClickable.keywords=t.clickable,sgmSearchSettings.itemLimits.howManyKeyword=t.itemCount,sgmSearchSettings.itemEnable.keyword=!0,sgmSearchSettings.highlightEnabled.keywords=t.highlight)}),_SgmntfY_._getJq().each(sgmSearchSettings.searchAssetsTexts,function(e,t){e===request.data.lang&&(sgmSearchSettings.texts.categories=t.categoriesText,sgmSearchSettings.texts.popularCategories=t.popularCategoriesText,sgmSearchSettings.texts.brands=t.brandsText,sgmSearchSettings.texts.popularBrands=t.popularBrandsText,sgmSearchSettings.texts.popularProducts=t.popularProductsText,sgmSearchSettings.texts.products=t.popularProductsText,sgmSearchSettings.texts.keywords=t.popularKeywordsText,sgmSearchSettings.texts.cancelText=t.mobileCancelText,sgmSearchSettings.texts.notFound=t.notFoundText)}),sgmSearchSettings.data.categories=_SgmntfY_._getArrayOfMap(categories),sgmSearchSettings.data.brands=_SgmntfY_._getArrayOfMap(brands),sgmSearchSettings.data.keywords=_SgmntfY_._getArrayOfKeywordsMap(keywords),sgmSearchSettings.data.products=_SgmntfY_._getArrayOfProductMap(products),sgmSearchSettings.data.keywordsProducts=keywords,sgmSearchSettings.data.categoryProducts=categoryProducts,sgmSearchSettings.data.brandProducts=brandProducts,sgmSearchSettings.data.itemEnable=sgmSearchSettings.itemEnable,sgmSearchSettings.data.texts=sgmSearchSettings.texts;try{if(sgmSearchSettings.preJs){eval(sgmSearchSettings.preJs);var retVal=preRenderConf(sgmSearchSettings);if(void 0!==retVal&&!retVal)return void _SgmntfY_.LOG_MESSAGE("WARN","preRenderConf returned false exiting!")}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product search pre js code: "+e)}_SgmntfY_._populateSearchResults(sgmSearchSettings.data,null,!0),_SgmntfY_._getJq()(document).on("submit",sgmSearchSettings.searchResultsEl+" form",function(e){e.preventDefault(),_SgmntfY_._goToSearchResultPage()}),_SgmntfY_._getJq()(document).on("click",".sgm-search-sidebar ul li",function(){var e=_SgmntfY_._getJq()(this).parent("ul").data("group");!0===sgmSearchSettings.isSidebarItemsClickable[e]&&((_SgmntfY_._getJq()(this).attr("data-url")||"")&&(location.href=_SgmntfY_._getJq()(this).attr("data-url"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-open")))}),_SgmntfY_._getJq()(document).on("mouseover",".sgm-search-sidebar li",function(){if(_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&_SgmntfY_._decodeHtml(_SgmntfY_._getJq()(".sgm-search-products-title").html())!==_SgmntfY_._getJq()(this).text()){var e=_SgmntfY_._getJq()(this).parent("ul").data("group");_SgmntfY_._getJq()(".sgm-search-sidebar li.selected").removeClass("selected"),_SgmntfY_._getJq()(".sgm-search-sidebar li.sgm-search-selected").removeClass("sgm-search-selected"),_SgmntfY_._getJq()(this).addClass("selected"),_SgmntfY_._getJq()(this).addClass("sgm-search-selected");var t=_SgmntfY_._getJq()(this).data("original"),n=[];"keywords"==e?n=sgmSearchSettings.data.keywordsProducts:"categories"==e?n=sgmSearchSettings.data.categoryProducts:"brands"==e&&(n=sgmSearchSettings.data.brandProducts),_SgmntfY_._getJq().each(n,function(e,n){if(e==t){var a=[];a.products=_SgmntfY_._getArrayOfProductMap(n),_SgmntfY_._populateSearchResults(a,"products")}}),_SgmntfY_._getJq()(".sgm-search-products-title").html(_SgmntfY_._getJq()(this).text())}}),_SgmntfY_._getJq()(window).on("load resize scroll",function(e){_SgmntfY_._setSearchResultsPosition(),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile")),_SgmntfY_._openSearchResults()}),_SgmntfY_._getJq()(window).bind("orientationchange",function(e){_SgmntfY_._openSearchResults(),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device"))}),_SgmntfY_._getJq()(document).on("click","#sgm-mobile-input-cancel",function(e){return _SgmntfY_.mobileSearchCancel()}),_SgmntfY_._getJq()(document).on("click",".sgm-search-show-all",function(e){document.location=sgmSearchSettings.searchUrlPrefix+sgmSearchBoxLastKeyword}),_SgmntfY_._getJq()(document).on("click","*",function(e){try{if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("open")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-open")){var t=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl),n=_SgmntfY_._getJq()(sgmSearchSettings.input);if(!t.is(e.target)&&0===t.has(e.target).length&&!_SgmntfY_._getJq()(n).is(":focus")||"sgm-mobile-input-cancel"==_SgmntfY_._getJq()(e.target).attr("id")){var a=document.querySelector(sgmSearchSettings.searchResultsEl);bodyScrollLock.enableBodyScroll(a),_SgmntfY_._getJq()(".seg-search-wrapper").remove(),manuelTriggerClicked=!1}}}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in document click: "+e)}}),_SgmntfY_._getJq()(".sgm-search-wrapper").addClass("seg-infinit-z-index")}},_goToSearchResultPage(){var e=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find("input").val();return e.length>0&&(window.location.href=sgmSearchSettings.searchUrlPrefix+encodeURIComponent(e)),!1},_initSearch:function(e,t){function n(){0===_SgmntfY_._getJq()(".seg-search-wrapper").length&&_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"}).appendTo("body");if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device"));var e=!1;try{e=0===sgmSearchSettings.mobileSearchAssets.length}catch(e){}e&&(_SgmntfY_._getJq()(".seg-search-wrapper").addClass("no-sidebar"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-no-sidebar")),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("mobile"),_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-mobile")}if(!_SgmntfY_._getJq()(".seg-search-wrapper")||!0!==_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("open")&&!0!==_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-open")){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var t,n=_SgmntfY_._getJq()("meta");if(n){if(hasSpecialWidth=!1,hasViewport=!1,_SgmntfY_._getJq().each(n,function(e,t){"viewport"===t.name&&(hasViewport=!0,!0===t.content.includes("width=")&&!0!==t.content.includes("width=device-width")&&(hasSpecialWidth=!0),!1===hasSpecialWidth?(!0!==t.content.includes("width=device-width")&&(t.content=t.content.concat(" ,width=device-width")),!0!==t.content.includes("initial-scale=")&&(t.content=t.content.concat(" ,initial-scale=1.0")),!0!==t.content.includes("maximum-scale=")&&(t.content=t.content.concat(" ,maximum-scale=1.0")),!0!==t.content.includes("user-scalable=")&&(t.content=t.content.concat(" ,user-scalable=no"))):!0!==t.content.includes("user-scalable=")&&(t.content=t.content.concat(" ,user-scalable=no")))}),!1===hasViewport)(t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}else(t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}var r=_SgmntfY_._getFocusedInput();sgmLastFocusedInput=_SgmntfY_._getFocusedInput(),_SgmntfY_._variables.search.keywordSearch=_SgmntfY_._getJq()(r).val().length>0,_SgmntfY_._variables.search.emptySearch=0===_SgmntfY_._getJq()(r).val().length,_SgmntfY_._getJq()(r).val().length<_SgmntfY_._variables.search.searchMinChar&&(_SgmntfY_._variables.search.keywordSearch=!1,_SgmntfY_._variables.search.emptySearch=!0),(0===_SgmntfY_._getJq()(r).val().length||_SgmntfY_._getJq()(r).val().length>=_SgmntfY_._variables.search.searchMinChar)&&a()}}function a(e){var t=_SgmntfY_._getFocusedInput(),n=_SgmntfY_._getJq()(t).val();if(manuelTriggerClicked=!1,!0===e&&(manuelTriggerClicked=!0,n=""),sgmSearchBoxLastKeyword=n,!0===_SgmntfY_._variables.search.emptySearch)_SgmntfY_._variables.segmentifyObj("search",{query:""});else{try{clearTimeout(searchTimer)}catch(e){}searchTimer=setTimeout(function(){0!==_SgmntfY_._getJq()(t).val().length&&_SgmntfY_._variables.segmentifyObj("search",{query:n})},_SgmntfY_._variables.search.searchDelay)}}_SgmntfY_._variables.search.input=e,_SgmntfY_._getJq()(e).unbind(),_SgmntfY_._getJq()(t).unbind(),_SgmntfY_._getJq()(e).attr("autocomplete","OFF"),"safari"===bowser.name.toLowerCase()||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?_SgmntfY_._getJq()(document).on("click",e+", #sgm-mobile-input input",n):_SgmntfY_._getJq()(document).on("focus",e+", #sgm-mobile-input input",n),_SgmntfY_._getJq().each(_SgmntfY_._getJq()(e),function(){if(_SgmntfY_._getJq()(this).is(":focus"))return _SgmntfY_._getJq()(this).blur(),_SgmntfY_._getJq()(this).focus(),!1}),_SgmntfY_._evalSearchBodyScrollLockPreJs(),_SgmntfY_._getJq()(document).on("input",e+", #sgm-mobile-input input",function(t){var n=_SgmntfY_._getFocusedInput();_SgmntfY_._getJq()(e).not("#sgm-mobile-input input").val(_SgmntfY_._getJq()(n).val()),_SgmntfY_._variables.search.keywordSearch=_SgmntfY_._getJq()(n).val().length>0,_SgmntfY_._variables.search.emptySearch=0===_SgmntfY_._getJq()(n).val().length,_SgmntfY_._getJq()(n).val().length<_SgmntfY_._variables.search.searchMinChar&&(_SgmntfY_._variables.search.keywordSearch=!1,_SgmntfY_._variables.search.emptySearch=!0),(0===_SgmntfY_._getJq()(n).val().length||_SgmntfY_._getJq()(n).val().length>=_SgmntfY_._variables.search.searchMinChar)&&a()}),_SgmntfY_._getJq()(document).on("blur","#sgm-mobile-input input",function(){_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("keyboard-on"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-keyboard-on"),_SgmntfY_._getJq()("input, textarea").removeAttr("readonly")}),t&&_SgmntfY_._getJq()(document).on("click",t,function(){0===_SgmntfY_._getJq()(".seg-search-wrapper").length&&_SgmntfY_._getJq()("<div/>",{class:"seg-search-wrapper"}).appendTo("body");_SgmntfY_._variables.search.emptySearch=!0,_SgmntfY_._variables.search.keywordSearch=!1,a(!0)})},_getFocusedInput:function(){var e;return _SgmntfY_._getJq()("input").each(function(){if(_SgmntfY_._getJq()(this).is(":focus"))return e=this,!1}),_SgmntfY_._getJq()(e)},_getArrayOfMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:a},n+=1}),t},_getArrayOfProductMap:function(e){var t=[];return _SgmntfY_._getJq().each(e,function(e,n){var a={};if(_SgmntfY_._getJq().extend(a,n),a.name=_SgmntfY_._decodeHtml(n.name),n.category&&n.category.length>0){if(0==sgmSearchSettings.categoryTreeView){var r=n.category[0].replace(/>/g,"/").toLocaleLowerCase();r=(r=r.split("/"))[r.length-1],a.category=r}else a.category=n.category[0].replace(/>/g,"/").toLocaleLowerCase();a["categories-original"]=n.category[0],1==sgmSearchSettings.incremental&&(a["categories-original"]=[],_SgmntfY_._getJq().each(n.category,function(e,t){a["categories-original"].push(t)}))}a.brand&&(a.brand=n.brand.toLocaleLowerCase("tr-TR"),a["brands-original"]=n.brand),t.push(a)}),t},_getArrayOfKeywordsMap:function(e){var t=[],n=0;return _SgmntfY_._getJq().each(e,function(e,a){t[n]={name:e,url:sgmSearchSettings.searchUrlPrefix+e},n+=1}),t},_fillSearchResults:function(renderedHtml,type){try{0===_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(renderedHtml):"products"===type?_SgmntfY_._getJq()(".sgm-search-products ul").html(renderedHtml):0===_SgmntfY_._getJq()(".sgm-search-sidebar").length?_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).html(renderedHtml):_SgmntfY_._getJq()(".sgm-search-sidebar").html(renderedHtml),null==document.getElementById("sgmStyle")&&sgmSearchSettings.css&&_SgmntfY_._getJq()('<style id="sgmStyle" />').html(sgmSearchSettings.css).prependTo(_SgmntfY_._getJq()("body"))}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in filling target element["+targetElement+"] with product recommendations: "+e)}try{sgmSearchSettings.postJs&&eval(sgmSearchSettings.postJs)}catch(e){_SgmntfY_.LOG_MESSAGE("WARN","Error in executing product SEARCH post js code: "+e)}},_decodeHtml:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},_populateSearchResults:function(e,t,n){e.emptySearch=_SgmntfY_._variables.search.emptySearch,e.keywordSearch=_SgmntfY_._variables.search.keywordSearch;var a,r=new DOMParser,i=r.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-product-template"),s={};if(_SgmntfY_._getJq().extend(s,e),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth?s.products=e.products.slice(0,sgmSearchSettings.itemLimits.howManyMobileProduct):s.products=e.products.slice(0,sgmSearchSettings.itemLimits.howManyDesktopProduct),"products"==t)a=_SgmntfY_._getMustache().render(i.innerHTML,s),_SgmntfY_._fillSearchResults(a,"products");else{if(0===_SgmntfY_._getJq()(".sgm-search-sidebar").length)var o=r.parseFromString(sgmSearchSettings.html,"text/html").getElementById("sgm-search-template");else o=r.parseFromString(sgmSearchSettings.html,"text/html").getElementsByClassName("sgm-search-sidebar")[0];o=_SgmntfY_._decodeHtml(o.innerHTML),a=_SgmntfY_._getMustache().render(o,s,{products:i.innerHTML}),_SgmntfY_._fillSearchResults(a),1===_SgmntfY_._getJq()(".sgm-search-sidebar").length&&(a=_SgmntfY_._getMustache().render(i.innerHTML,s),_SgmntfY_._fillSearchResults(a,"products"))}if(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar").find("li").each(function(){if(0==sgmSearchSettings.categoryTreeView)e=(e=_SgmntfY_._getJq()(this).text().replace(/>/g,"/").toLocaleLowerCase().split("/"))[e.length-1];else var e=_SgmntfY_._getJq()(this).text().replace(/>/g,"/").toLocaleLowerCase();e=e.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" ");var t=_SgmntfY_._getJq()(sgmSearchSettings.input).val(),n=this.parentElement.getAttribute("data-group");_SgmntfY_._getJq()(window).width()>=_SgmntfY_._variables.search.maxMobileWidth&&t&&""!==t&&("categories"===n&&sgmSearchSettings.highlightEnabled.categories?e=_SgmntfY_._highlight(t,e):"brands"===n&&sgmSearchSettings.highlightEnabled.brands?e=_SgmntfY_._highlight(t,e):"keywords"===n&&sgmSearchSettings.highlightEnabled.keywords&&(e=_SgmntfY_._highlight(t,e))),_SgmntfY_._getJq()(this).html(e)}),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){if(0==_SgmntfY_._getJq()("#sgm-mobile-input").length)_SgmntfY_._getJq()("<input type='search' name='search' autocomplete='OFF'>").insertBefore(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).children(".sgm-search-header")).wrap('<div id="sgm-mobile-input"></div>').wrap('<form action="/"></form>'),_SgmntfY_._getJq()("#sgm-mobile-input").append('<div id="sgm-mobile-input-clear"></div><div id="sgm-mobile-input-cancel">'+sgmSearchSettings.texts.cancelText+"</div>"),setTimeout(function(){_SgmntfY_._getJq()("#sgm-mobile-input input").val(_SgmntfY_._getJq()(_SgmntfY_._getFocusedInput()).val()).focus(),_SgmntfY_._getJq()("input, textarea").not("#sgm-mobile-input input").attr("readonly","readonly")},10)}1==n&&_SgmntfY_._openSearchResults(!0)},_highlight:function(e,t){var n=e.toLocaleLowerCase(_SgmntfY_._variables.language),a=new RegExp(n,"ig");return t.replace(a,"<span class='sgm-search-keyword-highlight'>$&</span>")},_openSearchResults:function(e){_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("mobile")||_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).hasClass("sgm-search-mobile"),0==_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-sidebar li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-sidebar")),0==_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).find(".sgm-search-products li").length?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-products")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("no-products"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-no-products")),1==sgmSearchSettings.isSidebarItemsClickable.categories&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=categories] li").addClass("sgm-cursor-pointer"),1==sgmSearchSettings.isSidebarItemsClickable.brands&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=brands] li").addClass("sgm-cursor-pointer"),1==sgmSearchSettings.isSidebarItemsClickable.keywords&&_SgmntfY_._getJq()(".sgm-search-sidebar ul[data-group=keywords] li").addClass("sgm-cursor-pointer"),0==sgmSearchSettings.sgmSearchShowAll&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-show-all"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-show-all")),!0===manuelTriggerClicked?(_SgmntfY_._disableBodyScrollAndAddOpen(e),manuelTriggerClicked=!1):_SgmntfY_._getJq().each(_SgmntfY_._getJq()(sgmSearchSettings.input),function(){if(_SgmntfY_._getJq()(this).is(":focus"))return _SgmntfY_._disableBodyScrollAndAddOpen(e),!1})},_disableBodyScrollAndAddOpen:function(e){if(_SgmntfY_._setSearchResultsPosition(),e&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("open"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-open"),_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth)){var t=document.querySelector(".seg-search-wrapper");t&&bodyScrollLock.disableBodyScroll(t),0===sgmSearchSettings.mobileSearchAssets.length&&(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("no-sidebar"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-no-sidebar"))}},_setSearchResultsPosition:function(){if(_SgmntfY_._getJq()(window).width()<_SgmntfY_._variables.search.maxMobileWidth){var e=.01*_SgmntfY_._getJq()(window).innerHeight();document.documentElement.style.setProperty("--vh",`${e}px`),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("sgm-search-mobile"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&_SgmntfY_._getJq()(".seg-search-wrapper").addClass("sgm-search-ios-device")}else{_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-mobile"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("sgm-search-ios-device");try{clearInterval(searchBoxInterval),clearTimeout(searchBoxTimeOut)}catch(e){}_SgmntfY_._setSearchPositionInterval(),searchBoxInterval=setInterval(_SgmntfY_._setSearchPositionInterval,10),searchBoxTimeOut=setTimeout(function(){clearInterval(searchBoxInterval)},3e3)}},_setSearchPositionInterval:function(){if(!(_SgmntfY_._getJq()(window).width()>_SgmntfY_._variables.search.maxMobileWidth&&(_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("no-products")||_SgmntfY_._getJq()(".seg-search-wrapper").hasClass("sgm-search-no-products")))){var e=sgmSearchSettings.openingDirection.toLowerCase();if(stickyFlag=!1,doNothing=!1,_SgmntfY_._getJq()(sgmLastFocusedInput).parents().not("body").not("html").each(function(){if("fixed"==_SgmntfY_._getJq()(this).css("position"))return stickyFlag=!0,!1}),_SgmntfY_._getJq()(_SgmntfY_._getFocusedInput()).parents().not("body").not("html").each(function(){if("none"==_SgmntfY_._getJq()(this).css("display"))return doNothing=!0,_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("open"),_SgmntfY_._getJq()(".seg-search-wrapper").removeClass("sgm-search-open"),!1}),0==doNothing){if(1==stickyFlag?(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-fixed")):(_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).removeClass("seg-position-absolute"),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).addClass("seg-position-absolute")),inputPosition=_SgmntfY_._getJq()(sgmLastFocusedInput).offset(),lastInputPosition={top:"",left:""},"undefined"==typeof inputPosition)return;if(inputPosition.top!==lastInputPosition.top){var t=_SgmntfY_._getJq()(sgmLastFocusedInput).outerHeight();if(1==stickyFlag)var n=inputPosition.top-_SgmntfY_._getJq()(window).scrollTop()+t+1;else n=inputPosition.top+t+1;_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("top",n),lastInputPosition.top=inputPosition.top}if(inputPosition.left!==lastInputPosition.left){var a=_SgmntfY_._getJq()(window).width(),r=_SgmntfY_._getJq()(sgmLastFocusedInput).parent().outerWidth(),i=_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).outerWidth(),s={right:inputPosition.left,center:inputPosition.left-i/2+r/2,left:inputPosition.left+r-i};"right"==e?s[e]+i>=a&&(s[e]=s.center):"left"==e&&s[e]<=0&&(s[e]=s.center),s[e]==s.center&&(s.center<=0||s.center+i>=a)&&(s[e]=a/2-i/2),_SgmntfY_._getJq()(sgmSearchSettings.searchResultsEl).css("left",s[e])}lastInputPosition=inputPosition}}},_evalSearchBodyScrollLockPreJs:function(){var e;(function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0});var n=!1;if("undefined"!=typeof window){var a={get passive(){n=!0}};window.addEventListener("testPassive",null,a),window.removeEventListener("testPassive",null,a)}var r="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),i=[],s=!1,o=-1,_=void 0,c=void 0,m=void 0,g=function(e){return i.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},d=function(e){var t=e||window.event;return!!g(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)},l=function(){setTimeout(function(){void 0!==m&&(document.body.style.paddingRight=m,m=void 0),void 0!==_&&(document.body.style.overflow=_,_=void 0),void 0!==c&&(_SgmntfY_._getJq()("html").css("overflow",c),c=void 0)})};e.disableBodyScroll=function(e,a){if(r){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(e&&!i.some(function(t){return t.targetElement===e})){var l={targetElement:e,options:a||{}};i=[].concat(t(i),[l]),e.ontouchstart=function(e){1===e.targetTouches.length&&(o=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-o;!g(e.target)&&(t&&0===t.scrollTop&&n>0?d(e):function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?d(e):e.stopPropagation())}(t,e)},s||(document.addEventListener("touchmove",d,n?{passive:!1}:void 0),s=!0)}}else{!function(e){setTimeout(function(){if(void 0===m){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(m=document.body.style.paddingRight,document.body.style.paddingRight=n+"px")}void 0===_&&(_=document.body.style.overflow,document.body.style.cssText="overflow:hidden !important",_SgmntfY_._getJq()("html").css("overflow","hidden !important")),void 0===c&&(c=_SgmntfY_._getJq()("html").css("overflow"),_SgmntfY_._getJq()("html").css("overflow","hidden"))})}(a);var f={targetElement:e,options:a||{}};i=[].concat(t(i),[f])}},e.clearAllBodyScrollLocks=function(){r?(i.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),s&&(document.removeEventListener("touchmove",d,n?{passive:!1}:void 0),s=!1),i=[],o=-1):(l(),i=[])},e.enableBodyScroll=function(e){if(r){if(!e)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");e.ontouchstart=null,e.ontouchmove=null,i=i.filter(function(t){return t.targetElement!==e}),s&&0===i.length&&(document.removeEventListener("touchmove",d,n?{passive:!1}:void 0),s=!1)}else(i=i.filter(function(t){return t.targetElement!==e})).length||l()}})(e={}),window.bodyScrollLock=e},_pushInitPermissionCampaign:function(e,t){if(t.safariEnabled&&"Safari"===_SgmntfY_._variables.pushInfo.agent){if("GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&"DENIED"!==_SgmntfY_._variables.pushInfo.subscription){!function(n){if("denied"===n.permission)return void fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent);"granted"===n.permission?_SgmntfY_._pushSendSafariSubscription(n):(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!1),_SgmntfY_._variables.pushInfo.safariEnabled=t.safariEnabled)}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))}}else if(_SgmntfY_._variables.pushInfo.isFirebaseCompatible&&"Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod){var n=_SgmntfY_._pushShouldShowPopUp();"NONE"===_SgmntfY_._variables.pushInfo.subscription?n?_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(n){if("denied"===n||"DENIED"===n)return _SgmntfY_.LOG_MESSAGE("ERROR","Permission requested denied!"),void fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+NaN+_SgmntfY_._variables.pushInfo.agent);"granted"===n||"GRANTED"===n?_SgmntfY_._pushGetFirebasePermission():"prompt"!==n&&"PROMPT"!==n||(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0))}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state "+e),_SgmntfY_._pushFadeUp(1)}):_SgmntfY_._pushRequestPermission():_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(a){a?"GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._pushSendSubscription(a,!1):"DENIED"===_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(a){"denied"!==a&&"DENIED"!==a&&(n?(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0)):_SgmntfY_._pushRequestPermission())}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state "+e),_SgmntfY_._pushFadeUp(1)})}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription "+e),_SgmntfY_._pushFadeUp(1)})}else if("Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod&&"Safari"!==_SgmntfY_._variables.pushInfo.agent){n=_SgmntfY_._pushShouldShowPopUp();"NONE"===_SgmntfY_._variables.pushInfo.subscription?n?_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(n){if("denied"===n||"DENIED"===n)return _SgmntfY_.LOG_MESSAGE("ERROR","Permission requested denied!"),void fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+NaN+_SgmntfY_._variables.pushInfo.agent);"granted"===n||"GRANTED"===n?_SgmntfY_._pushRequestPermissionVapid():"prompt"!==n&&"PROMPT"!==n||(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0))}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state "+e),_SgmntfY_._pushFadeUp(1)}):_SgmntfY_._pushRequestPermissionVapid():_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(a){a?"GRANTED"!==_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._pushSendSubscription(a,!0):"DENIED"===_SgmntfY_._variables.pushInfo.subscription&&_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.permissionState({userVisibleOnly:!0}).then(function(a){"denied"!==a&&"DENIED"!==a&&(n?(_SgmntfY_._pushRenderHtml(e,t),_SgmntfY_._pushBindClickHandlers(!0)):_SgmntfY_._pushRequestPermissionVapid())}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting push permission state "+e),_SgmntfY_._pushFadeUp(1)})}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription via vapid"+e),_SgmntfY_._pushFadeUp(1)})}},_pushFadeUp:function(e){_SgmntfY_._getJq()(".seg-popup-push").addClass("seg-fade-up"),window.setTimeout(function(){_SgmntfY_._getJq()(".seg-popup-push").remove()},e)},_pushRenderHtml:function(e,t){var n=_SgmntfY_._getMustache().render(e.html,t);_SgmntfY_._getJq()("body").prepend(n),e.css&&_SgmntfY_._getJq()("<style />").html(e.css).prependTo(_SgmntfY_._getJq()("body")),_SgmntfY_.LOG_MESSAGE("DEBUG","Push Permission appended to html body for campaign("+e.instanceId+")")},_pushBindClickHandlers:function(e){_SgmntfY_._getJq()(".seg-popup-push-bttn-later-new").click(function(){_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500)}),_SgmntfY_._getJq()(".seg-popup-push-bttn-allow-new").click(function(){if(_SgmntfY_._variables.segmentifyObj("event:interaction",{type:"push-permission-impression",instanceId:_SgmntfY_._variables.pushInfo.instanceId,interactionId:_SgmntfY_._variables.pushInfo.instanceId}),_SgmntfY_._pushFadeUp(500),e)if("Firebase"===_SgmntfY_._variables.pushInfo.permissionMethod)_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission()}).catch(function(e){"messaging/permission-blocked"===e.code&&(_SgmntfY_.LOG_MESSAGE("ERROR","Permission requested denied :"+e),fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent))});else if("Vapid"===_SgmntfY_._variables.pushInfo.permissionMethod){var t={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(t).then(function(e){_SgmntfY_._pushSendSubscription(e,!0)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details: "+e),_SgmntfY_._pushFadeUp(1)})}"Safari"===_SgmntfY_._variables.pushInfo.agent&&_SgmntfY_._variables.pushInfo.safariEnabled&&_SgmntfY_._pushGetSafariPermission()})},_pushGetSafariPermission:function(){!function e(t){"default"===t.permission?window.safari.pushNotification.requestPermission(_SgmntfY_._variables.pushInfo.safari.packageUrl,_SgmntfY_._variables.pushInfo.safari.webPushId,{},e):"denied"===t.permission?fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent).then(function(e){e.ok},function(e){}):"granted"===t.permission&&_SgmntfY_._pushSendSafariSubscription(t)}(window.safari.pushNotification.permission(_SgmntfY_._variables.pushInfo.safari.webPushId))},_pushShouldShowPopUp:function(){var e=bowser.name.toLowerCase(),t=parseFloat(bowser.version);return e.indexOf("chrome")>=0&&t>=80||(e.indexOf("firefox")>=0&&t>=72||(e.indexOf("opera")>=0&&t>=67||(e.indexOf("yandex")>=0&&t>=20||e.indexOf("samsung")>=0&&t>=12)))},_pushGetFirebasePermission:function(){_SgmntfY_._variables.pushInfo.messaging.getToken().then(function(e){e&&_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.getSubscription().then(function(e){_SgmntfY_._pushSendSubscription(e,!1)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details: "+e)})}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription token:  "+e)})},_pushRequestPermission:function(){_SgmntfY_._variables.pushInfo.messaging.requestPermission().then(function(){_SgmntfY_._pushGetFirebasePermission()}).catch(function(e){"messaging/permission-blocked"===e.code&&(_SgmntfY_.LOG_MESSAGE("ERROR","Permission requested denied :"+e),fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/deny?apiKey="+_SgmntfY_._variables.apiKey+"&userId="+_SgmntfY_._getUserId()+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId+"&browser="+_SgmntfY_._variables.pushInfo.agent))})},_pushRequestPermissionVapid:function(){var e={userVisibleOnly:!0,applicationServerKey:_SgmntfY_._pushUrlBase64ToUint8Array(_SgmntfY_._variables.pushInfo.vapid.publicKey)};_SgmntfY_._variables.pushInfo.serviceWorkerReg.pushManager.subscribe(e).then(function(e){_SgmntfY_._pushSendSubscription(e,!0)}).catch(function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while getting subscription details: "+e)})},_pushSendSubscription:function(e,t){var n=e.endpoint.split("/").slice(-1)[0],a=e.endpoint.replace(n,"").slice(0,-1),r=e.getKey?e.getKey("auth"):"",i=e.getKey?e.getKey("p256dh"):"",s=_SgmntfY_._getUserId(),o={subscriptionId:n,auth:r?btoa(String.fromCharCode.apply(null,new Uint8Array(r))):"",key:i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):"",userId:s,agent:_SgmntfY_._variables.pushInfo.agent,endpoint:a,deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:t};fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/push?apiKey="+_SgmntfY_._variables.apiKey+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(function(e){e.ok},function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while sending subscription info to BE:  "+e)})},_pushSendSafariSubscription:function(e){var t={subscriptionId:e.deviceToken,auth:"",key:"",userId:_SgmntfY_._getUserId(),agent:"Safari",endpoint:"",deviceType:_SgmntfY_._variables.ua.type.toUpperCase(),isVapid:!1};fetch(_SgmntfY_._variables.pushInfo.dataCenter+"subscription/push?apiKey="+_SgmntfY_._variables.apiKey+"&instanceId="+_SgmntfY_._variables.pushInfo.instanceId,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){e.ok},function(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error while sending subscription info to BE:  "+e)})},_pushUrlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length),r=0;r<n.length;++r)a[r]=n.charCodeAt(r);return a},_sourceOfUrl:function(){var e="";if(document.URL||document.referrer){if(_SgmntfY_._getQueryParameter("gclid").length)return"PAID";var t=_SgmntfY_._getQueryParameter("utm_medium");if(t.length)switch(t){case"social":e="SOCIAL";break;case"organic":e="SEARCH";break;case"cpc":case"cpm":case"ocpm":case"paid-media":case"affiliate":case"banner":case"retargeting":case"shopping":e="PAID";break;case"email":e="EMAIL"}if(!e.length){var n=document.referrer.replace("https://","").replace("http://","");-1!==(n=n.substring(0,n.indexOf("/"))).indexOf(_SgmntfY_._variables.domain)?e="INTERNAL":-1!==n.indexOf("facebook")||-1!==n.indexOf("twitter")||-1!==n.indexOf("t.co")||-1!==n.indexOf("instagram")||-1!==n.indexOf("pinterest")?e="SOCIAL":-1!==n.indexOf("google")||-1!==n.indexOf("g.co")||-1!==n.indexOf("bing")||-1!==n.indexOf("yandex")||-1!==n.indexOf("yahoo")?e="SEARCH":-1===n.indexOf("cimri.com")&&-1===n.indexOf("akakce.com")&&-1===n.indexOf("ucuzcu.com")&&-1===n.indexOf("bilio.com")&&-1===n.indexOf("auspreiser.de")&&-1===n.indexOf("billiger.de")&&-1===n.indexOf("dooyoo.de")&&-1===n.indexOf("geizhals.de")&&-1===n.indexOf("guenstiger.de")&&-1===n.indexOf("idealo.de")&&-1===n.indexOf("kelkoo.de")&&-1===n.indexOf("preis.de")&&-1===n.indexOf("preissuchmaschine.de")&&-1===n.indexOf("geizkragen.de")&&-1===n.indexOf("preisvergleich.de")&&-1===n.indexOf("preisroboter.de")&&-1===n.indexOf("vergelijk.be")&&-1===n.indexOf("pazaruvaj")&&-1===n.indexOf("nabava.net")&&-1===n.indexOf("ceneje.si")&&-1===n.indexOf("heureka")&&-1===n.indexOf("pricerunner")&&-1===n.indexOf("hinnavaatlus")&&-1===n.indexOf("skroutz.gr")&&-1===n.indexOf("agrep.hu")&&-1===n.indexOf("arukereso.hu")&&-1===n.indexOf("trovaprezzi.it")&&-1===n.indexOf("prisjakt.no")&&-1===n.indexOf("prisguiden.no")&&-1===n.indexOf("ceneo.pl")&&-1===n.indexOf("kuantokusta.pt")&&-1===n.indexOf("compari.ro")||(e="LISTING")}e.length||(e="OTHER")}return e},_enableSerializeForm:function(e){e.fn.sgmSerializeForm||(e.fn.sgmSerializeForm=function(){"use strict";var t={};return e.each(this.serializeArray(),function(n,a){var r=t[a.name];null!=r?e.isArray(r)?r.push(a.value):t[a.name]=[r,a.value]:t[a.name]=a.value}),e.each(t,function(n,a){null!=a&&e.isArray(a)&&(t[n]=a.join())}),t})},init:function(){_SgmntfY_._variables.namespace=window.SegmentifyTrackingObject,_SgmntfY_._variables.segmentifyObj=window[_SgmntfY_._variables.namespace];var e=_SgmntfY_._getQueryParameter("_sgm_tracking");if(_SgmntfY_._isNotEmpty(e)&&_SgmntfY_._setTracking(e),"disabled"!==_SgmntfY_._getTracking())if(_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj)&&_SgmntfY_._notNull(_SgmntfY_._variables.segmentifyObj.q)){if(_SgmntfY_._variables.initTimer&&window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_.modernize(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify is loading... ***"),_SgmntfY_._extend(!0,_SgmntfY_._variables,_SgmntfY_._variables.segmentifyObj.config),_SgmntfY_._functions.setLogLevel(_SgmntfY_._variables.logLevel),!(_SgmntfY_._variables.domain&&document.URL.indexOf(_SgmntfY_._variables.domain)>=0))return void console.error("Segmentify domain is not set properly: "+_SgmntfY_._variables.domain);if(window.onunload=_SgmntfY_._windowUnload,null==_SgmntfY_._variables.jq)_SgmntfY_._loadJavascript(_SgmntfY_._variables.jQueryUrl,!0,function(){_SgmntfY_._variables.jq=jQuery.noConflict(!0),_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode()});else{if(!_SgmntfY_._checkVersion("1.7",_SgmntfY_._variables.jq.fn.jquery))return void console.error("Segmentify requires jQuery version >= 1.7");_SgmntfY_._enableSerializeForm(_SgmntfY_._variables.jq),_SgmntfY_._initializeDelayedActions(),_SgmntfY_._initializeDelayedCampaigns(),_SgmntfY_._sendTrackedEvent(),_SgmntfY_._setTestMode()}null==_SgmntfY_._variables.mustache&&(_SgmntfY_._variables.mustache={},initializeMustache(_SgmntfY_._variables.mustache),_SgmntfY_._variables.mustache.tags=["[[","]]"]),_SgmntfY_._updateBrowserAndDeviceInfo(),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Running on a "+_SgmntfY_._variables.ua.type+" ***"),_SgmntfY_.LOG_MESSAGE("DEBUG","*** Segmentify loaded and started... ***"),_SgmntfY_.run(),_SgmntfY_._dispatchInitEvent()}else{if(++_SgmntfY_._variables.initTryCount,_SgmntfY_._variables.initTryCount>_SgmntfY_._variables.initTryLimit)return void window.clearTimeout(_SgmntfY_._variables.initTimer);window.clearTimeout(_SgmntfY_._variables.initTimer),_SgmntfY_._variables.initTimer=window.setTimeout(_SgmntfY_.init,100)}else _SgmntfY_.LOG_MESSAGE("DEBUG","End-user opted-out Segmentify tracking!")},_initializeDelayedActions:function(){try{var e=_SgmntfY_._getDelayedActions();_SgmntfY_._setDelayedActions([]);for(var t=new Date,n=0;n<e.length;n++)e[n].delayDate=new Date(e[n].delayDate),e[n].delayDate.getTime()>t.getTime()&&_SgmntfY_._addDelayedAction(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed actions: "+e)}},_initializeDelayedCampaigns:function(){try{var e=_SgmntfY_._getDelayedCampaigns();_SgmntfY_._setDelayedCampaigns([]);for(var t=new Date,n=0;n<e.length;++n)e[n].time=new Date(e[n].time),e[n].time.getTime()>t.getTime()&&_SgmntfY_._addDelayedCampaign(e[n])}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Can't initialize delayed campaigns: "+e)}},_dispatchInitEvent:function(){try{if(window.dispatchEvent){var e={testMode:_SgmntfY_._getTestMode()};window.dispatchEvent(new CustomEvent("segmentifyInited",{detail:e}))}}catch(e){}},_ajaxError:function(e,t,n,a){_SgmntfY_.LOG_MESSAGE("WARN","Error in sending event:\nEvent Data: "+JSON.stringify(e.data)+"\nResponse: "+t.responseText+"\nStatus: "+n+"\nError: "+a)},_ajaxSuccess:function(e,t,n){_SgmntfY_.LOG_MESSAGE("DEBUG","Success in sending event:\nEvent Data: "+JSON.stringify(e)+"\nStatus: "+n+"\nResponse Data: "+JSON.stringify(t))},_windowUnload:function(){_SgmntfY_._variables.isUnload=!0,window.clearTimeout(_SgmntfY_._variables.runTimer);for(var e=[];_SgmntfY_._variables.segmentifyObj.q.length>0;)try{var t=_SgmntfY_._variables.segmentifyObj.q.shift(),n=_SgmntfY_._functions.getFunction(t[0]),a=Array.prototype.slice.call(t,1);(i=n.apply(null,a)).originalParams.discardResponse="true",e.push(i)}catch(e){}for(var r=_SgmntfY_._getRetryQueue();r.length>0;)try{var i;(i=r.shift()).originalParams.discardResponse="true",e.push(i)}catch(e){}_SgmntfY_._setRetryQueue(e)},run:function(){try{if(_SgmntfY_._variables.jq&&(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0||_SgmntfY_._getDataLayer())&&!_SgmntfY_._variables.waitingKeys&&_SgmntfY_._variables.keysTryCount<5){var e=0,t=_SgmntfY_._getUserId(),n=_SgmntfY_._getSessionId();if(_SgmntfY_._isEmpty(t)?e=2:_SgmntfY_._isEmpty(n)?e=1:_SgmntfY_._isNotEmpty(n)&&_SgmntfY_._variables.segmentifyObj.q.length>0&&(_SgmntfY_._storePersistentData(_SgmntfY_._variables.sessionStorageKey,n,0,_SgmntfY_._variables.storage.session.local),_SgmntfY_._storePersistentData(_SgmntfY_._variables.userStorageKey,t,390,_SgmntfY_._variables.storage.user.local)),e>0)_SgmntfY_._updateUserAndSessionId(e);else{if(_SgmntfY_._variables.segmentifyObj.q&&_SgmntfY_._variables.segmentifyObj.q.length>0){var a=_SgmntfY_._variables.segmentifyObj.q.splice(0,_SgmntfY_._variables.segmentifyObj.q.length);_SgmntfY_._functions.callFunction(a)}_SgmntfY_._getDataLayer()&&_SgmntfY_._consumeDataLayer()}}window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}catch(e){_SgmntfY_.LOG_MESSAGE("ERROR","Error in run: "+e),window.clearTimeout(_SgmntfY_._variables.runTimer),_SgmntfY_._variables.runTimer=window.setTimeout(_SgmntfY_.run,_SgmntfY_._variables.constants.frequency)}},modernize:function(){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=a)return-1;for(var i=Math.max(r>=0?r:a-Math.abs(r),0);i<a;){if(i in n&&n[i]===e)return i;i++}return-1}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,a,r;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),a=new Array(s),r=0;r<s;){var o,_;r in i&&(o=i[r],_=e.call(n,o,r,i),a[r]=_),r++}return a});var e=JSON.stringify;if(JSON.stringify=function(t){var n=Array.prototype.toJSON,a=Number.prototype.toJSON,r=String.prototype.toJSON;delete Number.prototype.toJSON,delete Array.prototype.toJSON,delete String.prototype.toJSON;var i=void 0;try{i=e(t)}catch(e){i=void 0}return n&&(Array.prototype.toJSON=n),a&&(Number.prototype.toJSON=a),r&&(String.prototype.toJSON=r),i},"function"!=typeof window.CustomEvent){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}},LOG_MESSAGE:function(e,t){var n=_SgmntfY_._variables.logLevel,a=_SgmntfY_.LOG_LEVELS[e];void 0!==a&&a<=n&&console.log("Segmentify["+e+"]: "+t)}};_SgmntfY_.init()}(window);